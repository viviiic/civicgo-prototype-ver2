<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CivicGo 3.0 - è®“æ”¹è®Šå¾å··å£é–‹å§‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#14b8a6', /* Teal-500 */
                        primaryDark: '#0f766e',
                        secondary: '#f59e0b', /* Amber-500 */
                        bgBase: '#f8fafc', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'grow': 'grow 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'sway': 'sway 2s ease-in-out infinite alternate',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'slide-left': 'slideLeft 0.3s ease-out forwards',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        grow: {
                            '0%': { transform: 'scale(0) translateY(20px)', opacity: '0' },
                            '100%': { transform: 'scale(1) translateY(0)', opacity: '1' },
                        },
                        sway: {
                            '0%': { transform: 'rotate(-5deg)' },
                            '100%': { transform: 'rotate(5deg)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        },
                        slideLeft: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        glow: {
                            '0%': { filter: 'drop-shadow(0 0 2px #fcd34d)' },
                            '100%': { filter: 'drop-shadow(0 0 8px #f59e0b)' },
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: 100dvh; /* å„ªåŒ–ç§»å‹•ç«¯è¦–å£ */
            background-color: #e0e7ff;
            margin: 0;
            padding: 0;
        }

        /* æ‰‹æ©Ÿå®¹å™¨ */
        .app-container {
            width: 100%;
            height: 100vh;
            height: 100dvh; /* å„ªåŒ–ç§»å‹•ç«¯è¦–å£ */
            background-color: #f8fafc;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-width: 480px; /* å¦‚æœåœ¨æ¡Œé¢é è¦½ï¼Œé™åˆ¶æœ€å¤§å¯¬åº¦ */
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .page {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            background-color: #f8fafc;
            z-index: 1;
        }
        .page.active {
            display: flex;
            opacity: 1;
            z-index: 10;
        }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #f1f5f9;
            padding-bottom: env(safe-area-inset-bottom);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }

        .nav-item {
            transition: all 0.3s;
            color: #94a3b8;
        }
        .nav-item.active {
            color: #14b8a6;
        }
        .nav-item.active i {
            transform: translateY(-2px);
        }

        /* åœ°åœ–åœ–é‡˜ */
        .map-pin {
            position: absolute;
            transform: translate(-50%, -100%);
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 20;
        }
        .map-pin:hover {
            transform: translate(-50%, -100%) scale(1.1);
            z-index: 30;
        }
        .task-label {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 4px;
            background-color: #16A34A;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .map-pin.active .pin-body {
            animation: bounce 1s infinite;
            background-color: #fcd34d;
            border-color: #d97706;
        }
        .map-pin.active .task-label {
            display: block;
        }
        .pin-body {
            width: 44px;
            height: 44px;
            background: white;
            border: 3px solid #14b8a6;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }
        .pin-icon {
            transform: rotate(45deg);
            font-size: 1.2rem;
            color: #334155;
        }
        
        #map-viewport {
            background-color: #F5F3EF;
        }

        @keyframes bounce {
            0%, 100% { transform: rotate(-45deg) translateY(0); }
            50% { transform: rotate(-45deg) translateY(-5px); }
        }

        .living-flower {
            transform-origin: bottom center;
            animation: sway 3s ease-in-out infinite;
            animation-delay: calc(var(--delay) * 1s);
        }
        
        .setting-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: white;
            border-bottom: 1px solid #f1f5f9;
            color: #334155;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .setting-link:hover {
            background-color: #f8fafc;
        }
        .setting-link:last-child {
            border-bottom: none;
        }

        .faq-item {
            border-bottom: 1px solid #f1f5f9;
        }
        .faq-question {
            width: 100%;
            text-align: left;
            padding: 1rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
        }
        .faq-answer {
            display: none;
            padding: 0 1rem 1rem 1rem;
            color: #64748b;
            font-size: 0.875rem;
            background: white;
        }
        .faq-item.active .faq-answer {
            display: block;
        }
        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }
        
        .app-logo-avatar {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #14b8a6;
            font-size: 1.25rem;
        }
        .app-logo-avatar-lg {
            width: 64px;
            height: 64px;
            font-size: 2rem;
        }

        /* Onboarding Slides */
        .onboarding-slide {
            display: none;
            height: 100%;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            animation: slide-left 0.3s ease-out;
        }
        .onboarding-slide.active {
            display: flex;
        }
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #e2e8f0;
            transition: all 0.3s;
        }
        .dot.active {
            width: 24px;
            background-color: #14b8a6;
            border-radius: 99px;
        }
    </style>
</head>
<body>

<div class="app-container">

    <div id="page-splash" class="page active bg-gradient-to-br from-teal-500 to-emerald-600 items-center justify-center text-white p-8">
        <div class="text-center animate-float">
            <div class="w-28 h-28 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl">
                <i class="fa-solid fa-seedling text-6xl text-teal-600"></i>
            </div>
            <h1 class="text-5xl font-bold mb-2 tracking-wider">CivicGo</h1>
            <p class="text-teal-100 text-xl font-light tracking-widest">è®“æ”¹è®Šï¼Œå¾å··å£é–‹å§‹</p>
        </div>
        
        <div class="absolute bottom-16 w-full px-8">
            <button onclick="goToPage('page-onboarding')" class="w-full bg-white text-teal-600 font-bold py-4 rounded-full shadow-lg hover:bg-teal-50 transition-transform active:scale-95 flex items-center justify-center gap-3 text-lg">
                <i class="fa-brands fa-line text-3xl text-[#06C755]"></i>
                <span>LINE å¸³è™Ÿä¸€éµç™»å…¥</span>
            </button>
            <p class="text-center text-teal-200/80 text-xs mt-6">ç™»å…¥å³ä»£è¡¨åŒæ„æœå‹™æ¢æ¬¾èˆ‡éš±ç§æ¬Šæ”¿ç­–</p>
        </div>
    </div>

    <div id="page-onboarding" class="page bg-white">
        <div class="onboarding-slide active" id="slide-1">
            <div class="w-full flex-grow flex flex-col justify-center items-center">
                <div class="w-72 h-72 bg-blue-50 rounded-full flex items-center justify-center mb-10 relative">
                    <i class="fa-solid fa-map-location-dot text-9xl text-blue-500 animate-float"></i>
                    <div class="absolute top-4 right-4 w-16 h-16 bg-amber-400 rounded-full flex items-center justify-center text-white animate-bounce shadow-md">
                        <i class="fa-solid fa-star text-2xl"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">æ¢ç´¢å¾®å‹ä»»å‹™</h2>
                <p class="text-gray-500 leading-relaxed px-6 text-lg">
                    æ‰“é–‹åœ°åœ–ï¼Œç™¼ç¾èº«é‚Š 10 åˆ†é˜å…§<br>å¯å®Œæˆçš„å…¬ç›Šè¡Œå‹•ã€‚<br>
                    <span class="text-teal-600 font-bold">è®“å–„æ„ä¸å†é™ä¸å¯åŠã€‚</span>
                </p>
            </div>
            <div class="w-full pb-12 px-8">
                <div class="flex justify-center gap-3 mb-8">
                    <div class="dot active"></div><div class="dot"></div><div class="dot"></div>
                </div>
                <button onclick="nextSlide(2)" class="w-full bg-teal-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-teal-600 transition text-lg">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>

        <div class="onboarding-slide" id="slide-2">
            <div class="w-full flex-grow flex flex-col justify-center items-center">
                 <div class="w-72 h-72 bg-teal-50 rounded-full flex items-center justify-center mb-10 relative">
                    <i class="fa-solid fa-camera text-9xl text-teal-500 animate-float"></i>
                    <div class="absolute bottom-6 left-6 w-20 h-20 bg-white rounded-2xl shadow-lg flex items-center justify-center text-green-500 animate-pulse-slow">
                        <i class="fa-solid fa-check text-4xl"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">åªéœ€ä¸€æ‹ï¼ŒAI é©—è­‰</h2>
                <p class="text-gray-500 leading-relaxed px-6 text-lg">
                    å®Œæˆä»»å‹™å¾Œæ‹ç…§ä¸Šå‚³ï¼ŒAI è‡ªå‹•è­˜åˆ¥ã€‚<br>
                    å³æ™‚ç²å¾—<span class="text-teal-600 font-bold">ç©åˆ†å›é¥‹</span>ï¼Œç´¯ç©æ‚¨çš„ä¿¡ç”¨ã€‚
                </p>
            </div>
            <div class="w-full pb-12 px-8">
                <div class="flex justify-center gap-3 mb-8">
                    <div class="dot"></div><div class="dot active"></div><div class="dot"></div>
                </div>
                <button onclick="nextSlide(3)" class="w-full bg-teal-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-teal-600 transition text-lg">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>

        <div class="onboarding-slide" id="slide-3">
            <div class="w-full flex-grow flex flex-col justify-center items-center">
                <div class="w-72 h-72 bg-pink-50 rounded-full flex items-center justify-center mb-10 relative">
                    <i class="fa-solid fa-gift text-9xl text-pink-400 animate-float"></i>
                     <i class="fa-solid fa-seedling text-5xl text-green-500 absolute top-10 left-10 animate-bounce"></i>
                     <i class="fa-solid fa-clover text-5xl text-emerald-500 absolute bottom-10 right-10 animate-bounce" style="animation-delay: 0.5s"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">æ‰“é€ åŸå¸‚èŠ±åœ’</h2>
                <p class="text-gray-500 leading-relaxed px-6 text-lg">
                    ç”¨å–„è¡ŒçŒæº‰èŠ±æœµï¼Œè§£é–ç¨€æœ‰æ¤ç‰©ã€‚<br>
                    ç©åˆ†é‚„å¯å…Œæ› <span class="text-teal-600 font-bold">LINE POINTS</span>ï¼
                </p>
            </div>
            <div class="w-full pb-12 px-8">
                 <div class="flex justify-center gap-3 mb-8">
                    <div class="dot"></div><div class="dot"></div><div class="dot active"></div>
                </div>
                <button onclick="goToPage('page-home')" class="w-full bg-teal-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-teal-600 transition text-lg">é–‹å§‹é«”é©— CivicGo</button>
            </div>
        </div>
    </div>

    <div id="page-home" class="page bg-slate-50">
        <div class="px-6 pt-12 pb-4 bg-white shadow-sm flex justify-between items-center z-10">
            <div>
                <p class="text-gray-500 text-xs mb-1">æ—©å®‰ï¼Œé„°é‡Œè‹±é›„</p>
                <h2 class="text-2xl font-bold text-gray-800">NCUEfreshman</h2>
            </div>
            <div class="relative cursor-pointer" onclick="toggleNotificationModal()">
                <i class="fa-regular fa-bell text-xl text-gray-600"></i>
                <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"></span>
            </div>
        </div>

        <div class="flex-grow overflow-y-auto hide-scrollbar p-6 space-y-6">
            
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                <p id="mood-title" class="text-gray-600 font-medium mb-3 text-sm">ä»Šå¤©å¿ƒæƒ…å¦‚ä½•ï¼Ÿç°½åˆ°é ˜å– 5 ç©åˆ†ï¼</p>
                <div id="mood-buttons" class="flex justify-between">
                    <button onclick="checkInMood(this)" class="flex flex-col items-center gap-1 transition hover:scale-110 group">
                        <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-xl group-hover:bg-orange-200">ğŸ˜„</div>
                        <span class="text-xs text-gray-500">é–‹å¿ƒ</span>
                    </button>
                    <button onclick="checkInMood(this)" class="flex flex-col items-center gap-1 transition hover:scale-110 group">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-xl group-hover:bg-blue-200">ğŸ˜Œ</div>
                        <span class="text-xs text-gray-500">å¹³éœ</span>
                    </button>
                    <button onclick="checkInMood(this)" class="flex flex-col items-center gap-1 transition hover:scale-110 group">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-xl group-hover:bg-gray-200">ğŸ˜</div>
                        <span class="text-xs text-gray-500">ä¸€èˆ¬</span>
                    </button>
                    <button onclick="checkInMood(this)" class="flex flex-col items-center gap-1 transition hover:scale-110 group">
                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-xl group-hover:bg-purple-200">ğŸ˜”</div>
                        <span class="text-xs text-gray-500">ä½è½</span>
                    </button>
                    <button onclick="checkInMood(this)" class="flex flex-col items-center gap-1 transition hover:scale-110 group">
                        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-xl group-hover:bg-red-200">ğŸ˜«</div>
                        <span class="text-xs text-gray-500">ç–²æ†Š</span>
                    </button>
                </div>
            </div>

            <div class="bg-gradient-to-r from-teal-500 to-emerald-500 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 opacity-10 transform translate-x-4 translate-y-4">
                    <i class="fa-solid fa-trophy text-9xl"></i>
                </div>
                <p class="text-teal-100 text-sm mb-1">æ‚¨å·²ç´¯è¨ˆè²¢ç»</p>
                <div class="flex items-baseline gap-2">
                    <span id="home-tasks-count" class="text-4xl font-bold">0</span>
                    <span class="text-lg">é …å¾®ä»»å‹™</span>
                </div>
                <p class="text-teal-50/80 text-xs mt-2">æ„Ÿè¬æ‚¨ç‚ºç¤¾å€çš„æ¯ä¸€æ¬¡ä»˜å‡ºï¼</p>

                <button onclick="shareApp()" class="mt-4 w-full flex items-center justify-center gap-2 text-sm bg-white text-teal-700 font-medium py-2.5 rounded-full shadow-sm active:scale-95">
                    <i class="fa-solid fa-share-nodes"></i>
                    <span>åˆ†äº« CivicGo çµ¦æœ‹å‹</span>
                </button>
            </div>

            <div>
                <h3 class="font-bold text-gray-800 text-lg mb-3">æ´»å‹•å…¬å‘Š</h3>
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                    <div class="flex items-start gap-3">
                         <div class="bg-red-100 text-red-600 p-2 rounded-lg flex-shrink-0">
                             <i class="fa-solid fa-bullhorn text-xl"></i>
                         </div>
                         <div>
                             <h3 class="font-bold text-gray-800 text-lg">é€±æœ«æ·¨ç˜è‹±é›„å¬é›†ä»¤ï¼</h3>
                             <p class="text-sm text-gray-500 mt-2 leading-relaxed">æœ¬é€±æœ«åœ¨å½°åŒ–æµ·æ¿±ï¼Œéœ€è¦æ‚¨çš„åŠ›é‡ä¸€èµ·è®“æµ·å²¸ç·šæ›´ç¾éº—ã€‚åƒåŠ è€…å¯ç²å¾—é¡å¤– 50 ç©åˆ†èˆ‡<span class="text-amber-500 font-bold">å°ˆå±¬å‹³ç« </span>ï¼</p>
                             <button class="mt-3 text-teal-600 text-sm font-bold hover:underline">æŸ¥çœ‹è©³æƒ… ></button>
                         </div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-gray-800 text-lg mb-3">æ°¸ä¹…æŒ‘æˆ°</h3>
                <div class="bg-indigo-50 rounded-2xl p-4 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-indigo-500 shadow-sm">
                            <i class="fa-solid fa-user-plus"></i>
                        </div>
                        <div>
                            <p class="font-bold text-indigo-900">é‚€è«‹å¤¥ä¼´åŠ å…¥</p>
                            <p class="text-xs text-indigo-600">é›™æ–¹çš†å¯ç²å¾— 20 ç©åˆ†</p>
                        </div>
                    </div>
                    <button onclick="copyInviteCode()" class="bg-indigo-500 text-white text-xs px-3 py-1.5 rounded-full font-medium hover:bg-indigo-600 transition">è¤‡è£½ä»£ç¢¼</button>
                </div>
            </div>
            
            <div class="pb-20" id="home-notifications">
                <h3 class="font-bold text-gray-800 text-lg mb-3">æœ€æ–°é€šçŸ¥</h3>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 divide-y divide-slate-50">
                    <div class="p-4 flex items-center gap-3">
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        <p class="text-sm text-gray-600 flex-grow">æ‚¨çš„ä»»å‹™ã€Œéš¨æ‰‹æ’¿åƒåœ¾ã€å·²é€šéé©—è­‰ï¼</p>
                        <span class="text-xs text-gray-400">1å°æ™‚å‰</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-nav-placeholder h-[65px]"></div> 
    </div>

    <div id="page-community" class="page bg-slate-50">
        <div class="pt-12 pb-2 px-4 bg-white shadow-sm z-10">
            <h1 class="text-xl font-bold text-center mb-4 text-gray-800">ç¤¾ç¾¤å‹•æ…‹</h1>
        </div>

        <div class="flex-grow overflow-y-auto hide-scrollbar pb-20">
            <div id="tab-feed" class="p-4 space-y-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm">
                    <div class="flex gap-3">
                        <div class="app-logo-avatar flex-shrink-0"><i class="fa-solid fa-seedling"></i></div>
                        <textarea id="post-input" class="w-full bg-slate-50 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-teal-500/50 resize-none" rows="2" placeholder="åˆ†äº«ä»Šå¤©çš„å–„è¡Œ..."></textarea>
                    </div>
                    <div class="flex justify-end mt-2">
                        <button onclick="addPost()" class="bg-teal-500 text-white px-4 py-1.5 rounded-full text-sm font-medium hover:bg-teal-600 transition">ç™¼ä½ˆ</button>
                    </div>
                </div>

                <div id="feed-list" class="space-y-4">
                    <div class="bg-white p-4 rounded-2xl shadow-sm">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <img src="https://placehold.co/40x40/f472b6/ffffff?text=C" class="w-10 h-10 rounded-full">
                                <div>
                                    <p class="font-bold text-sm text-gray-800">CivicLover123</p>
                                    <p class="text-xs text-gray-400">2 å°æ™‚å‰</p>
                                </div>
                            </div>
                            <span class="bg-blue-50 text-blue-600 text-[10px] px-2 py-1 rounded-full">#ç’°å¢ƒç¶­è­·</span>
                        </div>
                        <p class="text-gray-700 text-sm mb-3">ä»Šå¤©å»é€²å¾·è·¯å¹«å¿™æ’¿åƒåœ¾äº†ï¼é›–ç„¶å¾ˆç†±ï¼Œä½†çœ‹åˆ°è¡—é“è®Šä¹¾æ·¨å°±å¥½é–‹å¿ƒï¼ğŸ¥³ å¤§å®¶é€±æœ«æœ‰ç©ºä¹Ÿå¯ä»¥ä¸€èµ·ä¾†å–”ï½</p>
                        <div class="flex items-center gap-4 text-gray-500 text-sm border-t border-gray-50 pt-3">
                            <button onclick="toggleLike(this)" class="flex items-center gap-1 hover:text-red-500 transition"><i class="fa-regular fa-heart"></i> <span>12</span></button>
                            <button onclick="openComments('post1')" class="flex items-center gap-1 hover:text-blue-500 transition"><i class="fa-regular fa-comment"></i> <span>3</span></button>
                        </div>
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <div id="page-map" class="page">
        <div id="map-viewport" class="flex-grow relative w-full h-full overflow-hidden">
            <div id="map-container" class="w-full h-full relative origin-top-left">
                 <svg width="100%" height="100%" viewBox="0 0 400 800" preserveAspectRatio="xMidYMid slice" class="absolute top-0 left-0 opacity-60">
                    <rect width="400" height="800" fill="#eef2f6"/>
                    <path d="M200,0 L200,800 M0,400 L400,400 M100,0 L100,400 M300,400 L300,800" stroke="#cbd5e1" stroke-width="20"/>
                    <path d="M200,0 L200,800 M0,400 L400,400" stroke="white" stroke-width="2" stroke-dasharray="5,5"/>
                    <rect x="50" y="50" width="100" height="150" fill="#d1fae5" rx="10"/>
                    <rect x="250" y="500" width="120" height="120" fill="#d1fae5" rx="10"/>
                    <rect x="260" y="60" width="80" height="80" fill="#94a3b8"/>
                    <rect x="40" y="450" width="60" height="100" fill="#cbd5e1"/>
                </svg>
    
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none z-10">
                    <div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg relative z-10"></div>
                    <div class="w-12 h-12 bg-blue-500/30 rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 animate-ping"></div>
                </div>
    
                <div id="pin-task1" class="map-pin" style="top: 40%; left: 35%;" onclick="openTaskModal('task1')">
                    <div class="pin-body"><i class="pin-icon fa-solid fa-trash-can text-red-500"></i></div>
                    <span class="task-label">ä»»å‹™åŸ·è¡Œä¸­</span>
                </div>
                <div id="pin-task2" class="map-pin" style="top: 60%; left: 70%;" onclick="openTaskModal('task2')">
                    <div class="pin-body"><i class="pin-icon fa-solid fa-book text-blue-500"></i></div>
                    <span class="task-label">ä»»å‹™åŸ·è¡Œä¸­</span>
                </div>
                <div id="pin-task3" class="map-pin" style="top: 30%; left: 60%;" onclick="openTaskModal('task3')">
                    <div class="pin-body"><i class="pin-icon fa-solid fa-shirt text-yellow-500"></i></div>
                    <span class="task-label">ä»»å‹™åŸ·è¡Œä¸­</span>
                </div>
            </div>
        </div>

        <div class="absolute top-12 left-4 right-4 bg-white rounded-full shadow-md p-3 flex items-center gap-3 z-20">
            <i class="fa-solid fa-magnifying-glass text-gray-400 ml-2"></i>
            <input type="text" placeholder="æœå°‹é™„è¿‘ä»»å‹™..." class="flex-grow bg-transparent outline-none text-sm">
            <button onclick="openFilterModal()" class="bg-slate-100 p-2 rounded-full hover:bg-slate-200 transition"><i class="fa-solid fa-sliders text-gray-600"></i></button>
        </div>

        <button onclick="goToPage('page-post')" class="absolute bottom-24 right-4 w-14 h-14 bg-teal-500 text-white rounded-full shadow-lg flex items-center justify-center z-20 hover:bg-teal-600 transition hover:scale-105 active:scale-95">
            <i class="fa-solid fa-plus text-xl"></i>
        </button>

        <div class="bottom-nav-placeholder h-[65px]"></div>
    </div>

    <div id="page-rewards" class="page bg-slate-50">
        <div class="pt-12 pb-6 px-6 bg-gradient-to-b from-teal-500 to-teal-600 text-white rounded-b-[2rem] shadow-md z-10">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-teal-100 text-sm">å¯ç”¨ç©åˆ†</p>
                    <h1 class="text-4xl font-bold mt-1" id="reward-points-display">0</h1>
                </div>
                <div onclick="goToPage('sub-history')" class="bg-white/20 px-3 py-1 rounded-full text-xs backdrop-blur-sm cursor-pointer hover:bg-white/30 transition">
                    å…Œæ›ç´€éŒ„ >
                </div>
            </div>
        </div>

        <div class="flex-grow overflow-y-auto hide-scrollbar p-6 space-y-6 pb-24">
            <div>
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-hand-holding-heart text-red-400"></i> æ„›å¿ƒæè´ˆ
                </h3>
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-red-50 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                         <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center text-red-500">
                            <i class="fa-solid fa-gift"></i>
                         </div>
                         <div>
                             <p class="font-bold text-gray-800">æè´ˆç©åˆ†çµ¦ç¤¾ç¦åœ˜é«”</p>
                             <p class="text-xs text-gray-500">è®“å–„æ„å»¶çºŒ</p>
                         </div>
                    </div>
                    <button onclick="openDonateModal()" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm hover:bg-red-600 active:scale-95 transition">æè´ˆ</button>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-store text-teal-500"></i> ç©åˆ†å…Œæ›
                </h3>
                <div class="space-y-3">
                    <div class="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between">
                        <div class="flex items-center gap-3">
                             <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center text-green-500">
                                <i class="fa-brands fa-line text-2xl"></i>
                             </div>
                             <div>
                                 <p class="font-bold text-gray-800 text-sm">50 é» LINE POINTS</p>
                                 <p class="text-xs text-teal-600 font-medium">500 ç©åˆ†</p>
                             </div>
                        </div>
                        <button onclick="redeemItem(500, 'LINE POINTS')" class="bg-teal-50 text-teal-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-teal-100 transition">å…Œæ›</button>
                    </div>
                    <div class="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between">
                        <div class="flex items-center gap-3">
                             <div class="w-12 h-12 bg-amber-50 rounded-xl flex items-center justify-center text-amber-500">
                                <i class="fa-solid fa-mug-hot"></i>
                             </div>
                             <div>
                                 <p class="font-bold text-gray-800 text-sm">åœ¨åœ°å’–å•¡ 50å…ƒæŠ˜åƒ¹åˆ¸</p>
                                 <p class="text-xs text-teal-600 font-medium">300 ç©åˆ†</p>
                             </div>
                        </div>
                        <button onclick="redeemItem(300, 'å’–å•¡åˆ¸')" class="bg-teal-50 text-teal-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-teal-100 transition">å…Œæ›</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-garden" class="page bg-slate-50">
        <div class="pt-12 px-6 pb-6 bg-white shadow-sm z-10">
            <div class="flex items-center gap-4">
                <div class="relative">
                    <div class="app-logo-avatar app-logo-avatar-lg border-4 border-teal-50"><i class="fa-solid fa-seedling"></i></div>
                    <div class="absolute bottom-0 right-0 w-5 h-5 bg-amber-400 rounded-full border-2 border-white flex items-center justify-center text-[10px] text-white font-bold">1</div>
                </div>
                <div class="flex-grow">
                    <h2 class="text-xl font-bold text-gray-800">Hi, NCUEfreshman</h2>
                    <p class="text-xs text-gray-500">LV 1 æ–°æ‰‹å…¬æ°‘</p>
                    <div class="w-full h-2 bg-gray-100 rounded-full mt-2 overflow-hidden">
                        <div class="h-full bg-teal-400 rounded-full" style="width: 20%"></div>
                    </div>
                    <p class="text-[10px] text-right text-gray-400 mt-0.5">XP 10/50</p>
                </div>
            </div>
            <div class="grid grid-cols-4 gap-2 mt-6 text-center">
                <div>
                    <p class="text-xs text-gray-400 mb-1">ç¸½ç©åˆ†</p>
                    <p id="profile-total-points" class="font-bold text-gray-800 text-lg">0</p>
                </div>
                <div>
                    <p class="text-xs text-gray-400 mb-1">å®Œæˆä»»å‹™</p>
                    <p id="profile-tasks-completed" class="font-bold text-gray-800 text-lg">0</p>
                </div>
                <div>
                    <p class="text-xs text-gray-400 mb-1">ä¿¡ç”¨åˆ†</p>
                    <p class="font-bold text-teal-600 text-lg">100</p>
                </div>
                <div>
                    <p class="text-xs text-gray-400 mb-1">é‚€è«‹</p>
                    <p class="font-bold text-gray-800 text-lg">0</p>
                </div>
            </div>
        </div>

        <div class="flex-grow overflow-y-auto hide-scrollbar p-6 space-y-6 pb-24">
            
            <div class="bg-gradient-to-b from-sky-200 to-sky-100 rounded-3xl p-6 shadow-inner relative overflow-hidden min-h-[200px] flex flex-col justify-end">
                <h3 class="absolute top-4 left-0 w-full text-center text-sky-700/50 font-bold text-sm tracking-widest uppercase">My City Garden</h3>
                <i class="fa-solid fa-cloud text-white/60 text-4xl absolute top-6 left-6 animate-pulse-slow"></i>
                <i class="fa-solid fa-cloud text-white/40 text-3xl absolute top-10 right-10 animate-pulse-slow" style="animation-delay: 1s"></i>

                <div class="absolute bottom-0 left-0 w-full h-12 bg-emerald-400"></div>
                <div class="absolute bottom-0 left-0 w-full h-16 bg-emerald-500/50 rounded-t-[50%] transform scale-x-150 translate-y-8"></div>

                <div id="garden-container" class="relative z-10 flex justify-around items-end h-32 px-4 pb-4">
                    <div class="text-center text-sky-700/40 text-xs w-full absolute bottom-16">å°šæœªç¨®æ¤èŠ±æœµï¼Œå¿«å»è§£ä»»å‹™å§ï¼</div>
                </div>
            </div>

            <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100">
                 <button onclick="goToPage('sub-collection')" class="setting-link w-full group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-pink-100 text-pink-600 flex items-center justify-center"><i class="fa-solid fa-book-open"></i></div>
                        <span>èŠ±æœµåœ–é‘‘</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-300 text-xs group-hover:text-gray-500"></i>
                 </button>
                 <button onclick="goToPage('sub-impact')" class="setting-link w-full group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fa-solid fa-chart-pie"></i></div>
                        <span>æˆ‘çš„å½±éŸ¿åŠ›</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-300 text-xs group-hover:text-gray-500"></i>
                 </button>
                 <button onclick="goToPage('sub-partners')" class="setting-link w-full group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-amber-100 text-amber-600 flex items-center justify-center"><i class="fa-solid fa-handshake"></i></div>
                        <span>åˆä½œ NPO èˆ‡ç¤¾å€</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-300 text-xs group-hover:text-gray-500"></i>
                 </button>
                 <button onclick="goToPage('sub-csr')" class="setting-link w-full group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center"><i class="fa-solid fa-building"></i></div>
                        <span>åƒèˆ‡ä¼æ¥­ç¤¾æœƒè²¬ä»»</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-300 text-xs group-hover:text-gray-500"></i>
                 </button>
                 <button onclick="goToPage('sub-contact')" class="setting-link w-full group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-green-100 text-green-600 flex items-center justify-center"><i class="fa-solid fa-envelope"></i></div>
                        <span>è¯çµ¡æˆ‘å€‘</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-300 text-xs group-hover:text-gray-500"></i>
                 </button>
                 <button onclick="goToPage('sub-about')" class="setting-link w-full group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-gray-100 text-gray-600 flex items-center justify-center"><i class="fa-solid fa-circle-info"></i></div>
                        <span>é—œæ–¼ CivicGo</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-gray-300 text-xs group-hover:text-gray-500"></i>
                 </button>
            </div>
             <div class="text-center mt-4 pb-6">
                <button onclick="goToPage('page-splash')" class="text-red-400 text-xs font-medium hover:text-red-600">ç™»å‡ºå¸³è™Ÿ</button>
             </div>
        </div>
    </div>
    
    <div id="sub-history" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
            <button onclick="goToPage('page-rewards')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">å…Œæ›ç´€éŒ„</h1>
        </div>
        <div class="flex-grow p-6 space-y-4 overflow-y-auto">
            <div class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center">
                <div>
                    <p class="font-bold text-gray-800">LINE POINTS 50é»</p>
                    <p class="text-xs text-gray-400">2024/10/25 14:30</p>
                </div>
                <span class="text-red-500 font-bold text-sm">-500</span>
            </div>
             <div class="text-center text-gray-400 text-sm mt-4">æ²’æœ‰æ›´å¤šç´€éŒ„äº†</div>
        </div>
    </div>

    <div id="sub-collection" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
            <button onclick="goToPage('page-garden')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">èŠ±æœµåœ–é‘‘</h1>
        </div>
        <div class="flex-grow p-6 space-y-6 overflow-y-auto">
            <div>
                <h3 class="text-gray-600 font-bold mb-3">ä¸€èˆ¬æ¤ç‰©</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-white rounded-xl p-3 flex flex-col items-center shadow-sm">
                        <i class="fa-solid fa-clover text-3xl text-pink-400 mb-2"></i>
                        <span class="text-xs text-gray-600">ç²‰ç´…å¹¸é‹è‰</span>
                    </div>
                    <div class="bg-white rounded-xl p-3 flex flex-col items-center shadow-sm">
                        <i class="fa-solid fa-sun text-3xl text-yellow-400 mb-2"></i>
                        <span class="text-xs text-gray-600">å‘æ—¥è‘µ</span>
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <div id="sub-impact" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
            <button onclick="goToPage('page-garden')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">æˆ‘çš„å½±éŸ¿åŠ›</h1>
        </div>
        <div class="flex-grow p-6 space-y-4 overflow-y-auto pb-20">
            <div class="bg-white p-6 rounded-2xl shadow-sm text-center animate-fade-in-up">
                <div class="w-16 h-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl"><i class="fa-solid fa-list-check"></i></div>
                <p class="text-gray-500 text-xs">ç¸½å…±å®Œæˆ</p>
                <h2 class="text-3xl font-bold text-gray-800 my-1"><span id="impact-count">0</span> <span class="text-base font-normal">é …</span></h2>
                <p class="text-gray-800 font-bold">ä»»å‹™</p>
            </div>
            <button onclick="shareApp()" class="w-full bg-teal-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-teal-600 transition mt-4 animate-fade-in-up" style="animation-delay: 0.4s">
                <i class="fa-solid fa-share-nodes mr-2"></i> åˆ†äº«æˆ‘çš„æˆå°±
            </button>
        </div>
    </div>

    <div id="sub-partners" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
             <button onclick="goToPage('page-garden')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">åˆä½œå¤¥ä¼´</h1>
        </div>
        <div class="flex-grow p-6 space-y-4 overflow-y-auto">
            <div class="grid grid-cols-2 gap-4">
                <div onclick="showPartnerInfo('è¯å±±åŸºé‡‘æœƒ', 'æœå‹™åœ¨åœ°ç¨å±…é•·è¼©ï¼Œæä¾›é—œæ‡·è¨ªè¦–ã€‚')" class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center gap-3 cursor-pointer hover:shadow-md transition">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-600"><i class="fa-solid fa-heart"></i></div>
                    <span class="font-bold text-sm text-gray-700">è¯å±±åŸºé‡‘æœƒ</span>
                </div>
                </div>
        </div>
    </div>

    <div id="sub-csr" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
            <button onclick="goToPage('page-garden')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">åƒèˆ‡ CSR</h1>
        </div>
        <div class="flex-grow p-6 space-y-6 overflow-y-auto">
            <p class="text-gray-600 text-sm">å¸¶è‘—å“¡å·¥ä¸€èµ·åƒèˆ‡ä¼æ¥­ç¤¾æœƒè²¬ä»»ï¼Œå°‡æ¯ä¸€ä»½å½±éŸ¿åŠ›æ•¸æ“šåŒ–ã€‚</p>
            <div class="bg-white p-6 rounded-2xl shadow-sm space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">ä¼æ¥­çµ±ä¸€ç·¨è™Ÿ</label>
                    <input type="text" id="csr-id" class="w-full mt-1 p-3 bg-slate-50 rounded-lg outline-none border border-transparent focus:border-teal-500 transition" placeholder="è«‹è¼¸å…¥çµ±ç·¨">
                </div>
            </div>
             <button onclick="submitCSR()" class="w-full bg-white text-teal-600 font-bold py-3 rounded-xl shadow-sm border border-teal-100 hover:bg-teal-50 transition">
                ç¶å®šä¼æ¥­å¸³è™Ÿ
            </button>
        </div>
    </div>

    <div id="sub-contact" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
            <button onclick="goToPage('page-garden')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">è¯çµ¡æˆ‘å€‘</h1>
        </div>
        <div class="flex-grow p-6 space-y-6 overflow-y-auto">
            <div class="bg-white p-6 rounded-2xl shadow-sm space-y-4">
                <h3 class="font-bold text-gray-800">æ„è¦‹å›é¥‹</h3>
                <textarea class="w-full p-3 bg-slate-50 rounded-lg text-sm outline-none resize-none" rows="4" placeholder="è«‹è¼¸å…¥æ‚¨çš„å»ºè­°..."></textarea>
                <button onclick="showSimpleAlert('è¨Šæ¯å·²ç™¼é€ï¼Œæˆ‘å€‘å°‡ç›¡å¿«å›è¦†æ‚¨ï¼')" class="w-full bg-teal-500 text-white font-bold py-3 rounded-xl hover:bg-teal-600 transition">ç™¼é€è¨Šæ¯</button>
            </div>
        </div>
    </div>
    
    <div id="sub-about" class="page bg-slate-50">
        <div class="bg-white p-4 shadow-sm flex items-center gap-4 sticky top-0 z-20">
             <button onclick="goToPage('page-garden')" class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
            <h1 class="text-lg font-bold">é—œæ–¼ CivicGo</h1>
        </div>
        <div class="p-8 text-center pb-20 overflow-y-auto">
             <div class="w-24 h-24 bg-teal-500 rounded-2xl mx-auto mb-6 flex items-center justify-center text-white text-4xl shadow-lg animate-float"><i class="fa-solid fa-seedling"></i></div>
             <h2 class="text-2xl font-bold text-gray-800 mb-2">CivicGo</h2>
             <p class="text-gray-500 text-sm mb-8">è®“æ”¹è®Šï¼Œå¾å··å£é–‹å§‹ v3.0</p>
             <p class="text-xs text-gray-400 mt-8">Â© 2025 CivicGo Team. All rights reserved.</p>
        </div>
    </div>
    
    <div id="page-post" class="page bg-white">
         <div class="p-4 flex items-center gap-4 shadow-sm bg-white sticky top-0 z-10">
            <button onclick="goToPage('page-map')" class="text-gray-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h1 class="font-bold text-lg">ç™¼å¸ƒéœ€æ±‚</h1>
        </div>
        <div class="flex-grow overflow-y-auto p-6 space-y-6 pb-20">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ä»»å‹™æ¨™é¡Œ</label>
                    <input type="text" class="w-full p-3 bg-gray-50 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition" placeholder="ä¾‹å¦‚ï¼šé€±æœ«å…¬åœ’æ·¨ç˜æ´»å‹•">
                </div>
                 <div class="pt-4">
                    <button onclick="showSimpleAlert('éœ€æ±‚å·²é€å‡ºå¯©æ ¸ï¼'); goToPage('page-map')" class="w-full bg-teal-500 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-teal-600 transition active:scale-95">
                        ç¢ºèªç™¼å¸ƒ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-task" class="fixed inset-0 bg-black/40 z-50 hidden flex-col justify-end opacity-0 transition-opacity duration-300" onclick="closeTaskModal()">
        <div class="bg-white rounded-t-3xl p-6 transform translate-y-full transition-transform duration-300" id="modal-content" onclick="event.stopPropagation()">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
            <div id="task-detail-inject"></div>
        </div>
    </div>
    
    <div id="modal-donate" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-6" onclick="closeDonateModal()">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center" onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold text-gray-800 mb-4">é¸æ“‡æè´ˆå°è±¡</h3>
            <div class="space-y-3 mb-4 max-h-60 overflow-y-auto">
                <button onclick="selectNPO(this, 'è¯å±±åŸºé‡‘æœƒ')" class="npo-option w-full text-left p-3 rounded-xl border border-slate-100 hover:border-teal-500 hover:bg-teal-50 transition flex items-center gap-3">
                    <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center text-red-500"><i class="fa-solid fa-heart"></i></div>
                    <span class="font-medium text-gray-700">è¯å±±åŸºé‡‘æœƒ</span>
                </button>
                <button onclick="selectNPO(this, 'ä¼Šç”¸åŸºé‡‘æœƒ')" class="npo-option w-full text-left p-3 rounded-xl border border-slate-100 hover:border-teal-500 hover:bg-teal-50 transition flex items-center gap-3">
                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center text-orange-500"><i class="fa-solid fa-wheelchair"></i></div>
                    <span class="font-medium text-gray-700">ä¼Šç”¸åŸºé‡‘æœƒ</span>
                </button>
            </div>
            <div id="donate-input-area" class="hidden">
                <p class="text-sm text-gray-500 mb-2">è«‹è¼¸å…¥æè´ˆç©åˆ† (ç¾æœ‰: <span id="donate-modal-points">0</span>)</p>
                <input type="number" id="donate-amount" class="w-full p-3 bg-slate-50 rounded-xl text-center font-bold text-lg outline-none focus:ring-2 focus:ring-teal-500 mb-4" placeholder="50">
                <button onclick="confirmDonation()" class="w-full bg-teal-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-teal-600 transition">ç¢ºèªæè´ˆ</button>
            </div>
        </div>
    </div>
    
    <div id="modal-filter" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-6" onclick="closeFilterModal()">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">ç¯©é¸æ¢ä»¶</h3>
                <button onclick="closeFilterModal()" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="space-y-6">
                <button onclick="closeFilterModal(); showSimpleAlert('ç¯©é¸æ¢ä»¶å·²å¥—ç”¨')" class="w-full bg-teal-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-teal-600 transition">å¥—ç”¨ç¯©é¸</button>
            </div>
        </div>
    </div>
    
    <div id="modal-comments" class="fixed inset-0 bg-black/60 z-50 hidden flex-col justify-end" onclick="closeCommentsModal()">
        <div class="bg-white rounded-t-3xl p-6 h-[70vh] flex flex-col" onclick="event.stopPropagation()">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-4 flex-shrink-0"></div>
            <h3 class="text-lg font-bold text-gray-800 mb-4 text-center flex-shrink-0">ç•™è¨€</h3>
            <div id="comments-list" class="flex-grow overflow-y-auto space-y-4 mb-4 pr-2"></div>
            <div class="flex gap-2 flex-shrink-0 border-t pt-3">
                <input type="text" id="comment-input" class="flex-grow bg-gray-50 rounded-full px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-teal-500" placeholder="ç™¼è¡¨ç•™è¨€...">
                <button onclick="sendComment()" class="w-10 h-10 bg-teal-500 text-white rounded-full flex items-center justify-center shadow-sm hover:bg-teal-600 transition">
                    <i class="fa-solid fa-paper-plane text-sm"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="modal-notification" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-6" onclick="toggleNotificationModal()">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 max-h-[60vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">é€šçŸ¥ä¸­å¿ƒ</h3>
                <button onclick="toggleNotificationModal()" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="space-y-3">
                <div class="p-3 bg-slate-50 rounded-xl flex items-start gap-3">
                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
                    <div>
                        <p class="text-sm text-gray-700 font-medium">ä»»å‹™é©—è­‰é€šé</p>
                        <p class="text-xs text-gray-500">æ‚¨çš„ã€Œéš¨æ‰‹æ’¿åƒåœ¾ã€ä»»å‹™å·²å®Œæˆï¼Œç²å¾— 10 ç©åˆ†ã€‚</p>
                        <span class="text-[10px] text-gray-400">1å°æ™‚å‰</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-success" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-6" onclick="closeSuccessModal()">
        <div class="bg-white w-full max-w-sm rounded-3xl p-8 text-center transform scale-90 transition-transform duration-300" id="success-content" onclick="event.stopPropagation()">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl animate-bounce">
                ğŸ‰
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ä»»å‹™å®Œæˆï¼</h2>
            <p class="text-gray-500 mb-6">æ„Ÿè¬æ‚¨çš„ä»˜å‡ºï¼ŒèŠ±åœ’è£¡é•·å‡ºäº†ä¸€æœµæ–°èŠ±ï¼</p>
            <div class="bg-slate-50 p-4 rounded-xl mb-6 flex justify-center items-baseline gap-2">
                <span class="text-teal-600 font-bold text-3xl">+<span id="success-points">10</span></span>
                <span class="text-gray-400 text-xs">ç©åˆ†</span>
            </div>
            <button onclick="closeSuccessModal()" class="w-full bg-teal-500 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-teal-600 transition">å¤ªæ£’äº†</button>
        </div>
    </div>


    <div class="bottom-nav fixed bottom-0 left-0 w-full flex justify-around items-center z-40">
        <button onclick="goToPage('page-home')" class="nav-item active flex flex-col items-center p-2 w-1/5" data-target="page-home">
            <i class="fa-solid fa-house text-xl mb-1"></i>
            <span class="text-[10px] font-medium">ä¸»é </span>
        </button>
        <button onclick="goToPage('page-community')" class="nav-item flex flex-col items-center p-2 w-1/5" data-target="page-community">
            <i class="fa-solid fa-users text-xl mb-1"></i>
            <span class="text-[10px] font-medium">ç¤¾ç¾¤</span>
        </button>
        <button onclick="goToPage('page-map')" class="nav-item flex flex-col items-center p-2 w-1/5" data-target="page-map">
            <i class="fa-solid fa-map-location-dot text-xl mb-1"></i>
            <span class="text-[10px] font-medium">åœ°åœ–</span>
        </button>
        <button onclick="goToPage('page-rewards')" class="nav-item flex flex-col items-center p-2 w-1/5" data-target="page-rewards">
            <i class="fa-solid fa-gift text-xl mb-1"></i>
            <span class="text-[10px] font-medium">çå‹µ</span>
        </button>
        <button onclick="goToPage('page-garden')" class="nav-item flex flex-col items-center p-2 w-1/5" data-target="page-garden">
            <i class="fa-solid fa-user text-xl mb-1"></i>
            <span class="text-[10px] font-medium">å€‹äºº</span>
        </button>
    </div>

</div>

<script>
    // --- ç‹€æ…‹ç®¡ç† (å‡ç´šç‰ˆï¼šå„ªå…ˆå¾ LocalStorage è®€å–) ---
    const STORAGE_KEY = 'civicgo_data_v3';
    
    let state = {
        points: 1000,
        tasksCompleted: 0,
        flowers: [],
        acceptedTasks: [],
        completedTaskIds: [], // æ–°å¢ï¼šè¨˜éŒ„å·²å®Œæˆçš„ä»»å‹™ ID ä»¥ä¾¿éæ¿¾
        hasCheckedIn: false,
        lastLoginDate: new Date().toDateString() // æ–°å¢ï¼šç”¨ä¾†é‡ç½®æ¯æ—¥ç°½åˆ°
    };

    // åˆå§‹åŒ–ï¼šå˜—è©¦è®€å–å­˜æª”
    function loadState() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
                
                // æª¢æŸ¥æ˜¯å¦è·¨æ—¥ï¼Œè‹¥è·¨æ—¥å‰‡é‡ç½®ç°½åˆ°ç‹€æ…‹
                if (state.lastLoginDate !== new Date().toDateString()) {
                    state.hasCheckedIn = false;
                    state.lastLoginDate = new Date().toDateString();
                    saveState(); // æ›´æ–°æ—¥æœŸ
                }
            } catch (e) {
                console.error('è®€å–å­˜æª”å¤±æ•—', e);
            }
        }
    }

    // å­˜æª”å‡½æ•¸
    function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let selectedNPO = '';

    const postComments = {
        'post1': [
            { user: 'Alice', content: 'å“‡ï¼å¤ªæ£’äº†ï¼Œæˆ‘ä¹Ÿæƒ³åƒåŠ ä¸‹æ¬¡çš„æ´»å‹•ï¼ğŸ˜' },
            { user: 'Bob', content: 'æ„Ÿè¬ä½ çš„ä»˜å‡º ğŸ‘ğŸ‘' },
            { user: 'Charlie', content: 'è¾›è‹¦äº†ï¼' }
        ]
    };
    let currentPostId = '';

    const tasks = {
        'task1': { id: 'task1', title: 'éš¨æ‰‹æ’¿åƒåœ¾', type: 'ç’°å¢ƒ', time: '10 min', points: 10, icon: 'fa-trash-can', color: 'text-red-500', desc: 'è«‹å”åŠ©æ¸…ç†é€²å¾·è·¯å‘¨é‚Šçš„å¡‘è† åƒåœ¾ã€‚' },
        'task2': { id: 'task2', title: 'æè´ˆäºŒæ‰‹æ›¸', type: 'è³‡æº', time: '30 min', points: 20, icon: 'fa-book', color: 'text-blue-500', desc: 'åœ–æ›¸é¤¨å‹Ÿé›†å…’ç«¥ç¹ªæœ¬ï¼Œè«‹é€è‡³æ«ƒå°ã€‚ (éœ€äººå·¥é©—è­‰)' },
        'task3': { id: 'task3', title: 'å‹Ÿé›†äºŒæ‰‹å†¬è¡£', type: 'å…¬ç›Š', time: '20 min', points: 15, icon: 'fa-shirt', color: 'text-yellow-500', desc: 'ç‚ºç¨å±…é•·è¼©å‹Ÿé›†ä¿æš–è¡£ç‰©ã€‚' }
    };

    // --- é é¢å°èˆª ---
    function goToPage(pageId) {
        document.querySelectorAll('.page').forEach(el => {
            el.classList.remove('active');
            el.style.opacity = '0';
        });
        
        const target = document.getElementById(pageId);
        if (target) {
            target.classList.add('active');
            setTimeout(() => target.style.opacity = '1', 10);
            
            const isSubPage = pageId.startsWith('sub-') || pageId === 'page-splash' || pageId === 'page-post' || pageId === 'page-onboarding';
            const nav = document.querySelector('.bottom-nav');
            
            if (isSubPage) {
                nav.style.transform = 'translateY(100%)';
                nav.style.transition = 'transform 0.3s';
            } else {
                nav.style.transform = 'translateY(0)';
                document.querySelectorAll('.nav-item').forEach(btn => {
                    if (btn.dataset.target === pageId) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                updateUI();
                if(pageId === 'page-map') {
                    updateMapPins();
                }
            }
        }
    }

    function nextSlide(slideIndex) {
        document.querySelectorAll('.onboarding-slide').forEach(slide => {
            slide.classList.remove('active');
        });
        const target = document.getElementById(`slide-${slideIndex}`);
        if(target) target.classList.add('active');
    }

    // --- åŠŸèƒ½é‚è¼¯ ---
    function updateUI() {
        const pointsDisplays = ['home-tasks-count', 'reward-points-display', 'profile-total-points'];
        pointsDisplays.forEach(id => {
            const el = document.getElementById(id);
            if(el) el.innerText = (id === 'home-tasks-count' || id === 'profile-tasks-completed') ? state.tasksCompleted : state.points;
        });

        document.getElementById('profile-tasks-completed').innerText = state.tasksCompleted;
        document.getElementById('impact-count').innerText = state.tasksCompleted;
        
        // ç°½åˆ°æŒ‰éˆ•ç‹€æ…‹æ›´æ–°
        if (state.hasCheckedIn) {
            document.querySelectorAll('#page-home button[onclick^="checkInMood"]').forEach(btn => {
                 btn.disabled = true;
                 btn.classList.add('opacity-50', 'cursor-not-allowed');
                 btn.classList.remove('hover:scale-110');
            });
            document.getElementById('mood-title').innerText = 'ä»Šæ—¥å·²ç°½åˆ°ï¼Œæ˜å¤©è¦‹ï¼';
        }

        renderGarden();
    }

    function renderGarden() {
        const container = document.getElementById('garden-container');
        if (!container) return;
        
        if (state.flowers.length === 0) {
            container.innerHTML = '<div class="text-center text-sky-700/40 text-xs w-full absolute bottom-16">å°šæœªç¨®æ¤èŠ±æœµï¼Œå¿«å»è§£ä»»å‹™å§ï¼</div>';
            return;
        }

        container.innerHTML = '';
        state.flowers.forEach((color) => {
            const flower = document.createElement('div');
            const delay = Math.random() * 2; 
            flower.className = 'living-flower w-10 h-10 flex items-end justify-center';
            flower.style.setProperty('--delay', delay);
            flower.innerHTML = `
                <i class="fa-solid fa-location-pin text-emerald-600 text-lg absolute bottom-0"></i>
                <i class="fa-solid fa-clover text-3xl text-${color}-400 absolute bottom-2 animate-grow"></i>
            `;
            container.appendChild(flower);
        });
    }

    // --- ä»»å‹™æ¨¡çµ„ ---
    function openTaskModal(taskId) {
        const task = tasks[taskId];
        const modal = document.getElementById('modal-task');
        const content = document.getElementById('modal-content');
        const inject = document.getElementById('task-detail-inject');
        
        inject.innerHTML = `
            <div class="flex items-center gap-4 mb-4">
                <div class="w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center ${task.color} text-2xl">
                    <i class="fa-solid ${task.icon}"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-800">${task.title}</h2>
                    <div class="flex gap-2 mt-1">
                        <span class="text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded">${task.type}</span>
                        <span class="text-xs bg-amber-50 text-amber-600 px-2 py-0.5 rounded border border-amber-100">${task.time}</span>
                    </div>
                </div>
            </div>
            <p class="text-gray-600 mb-6 text-sm leading-relaxed">${task.desc}</p>
            <div class="flex gap-3" id="modal-actions">
                </div>
        `;

        const actionDiv = document.getElementById('modal-actions');
        
        // åˆ¤æ–·ç‹€æ…‹ï¼šå·²å®Œæˆ vs å·²æ¥å— vs æœªæ¥å—
        if (state.completedTaskIds && state.completedTaskIds.includes(taskId)) {
             actionDiv.innerHTML = `
                <button onclick="closeTaskModal()" class="flex-1 py-3 rounded-xl font-bold text-gray-500 bg-gray-100">å·²å®Œæˆ</button>
            `;
        } else if (state.acceptedTasks.includes(taskId)) {
            actionDiv.innerHTML = `
                <button onclick="closeTaskModal()" class="flex-1 py-3 rounded-xl font-bold text-gray-500 bg-gray-100">å–æ¶ˆ</button>
                <button onclick="completeTask('${taskId}', ${task.points})" class="flex-1 py-3 rounded-xl font-bold text-white bg-teal-500 shadow-lg shadow-teal-200 hover:bg-teal-600">
                    <i class="fa-solid fa-camera mr-1"></i> é»æ“Šé©—è­‰
                </button>
            `;
        } else {
             actionDiv.innerHTML = `
                <button onclick="closeTaskModal()" class="flex-1 py-3 rounded-xl font-bold text-gray-500 bg-gray-100">å†çœ‹çœ‹</button>
                <button onclick="acceptTask('${taskId}')" class="flex-1 py-3 rounded-xl font-bold text-white bg-teal-500 shadow-lg shadow-teal-200 hover:bg-teal-600">
                    æ¥å—ä»»å‹™
                </button>
            `;
        }

        modal.classList.remove('hidden');
        requestAnimationFrame(() => {
            modal.classList.remove('opacity-0');
            content.classList.remove('translate-y-full');
        });
    }
    
    function acceptTask(taskId) {
        state.acceptedTasks.push(taskId);
        saveState(); // å­˜æª”
        closeTaskModal();
        updateMapPins();
    }

    function closeTaskModal() {
        const modal = document.getElementById('modal-task');
        const content = document.getElementById('modal-content');
        content.classList.add('translate-y-full');
        modal.classList.add('opacity-0');
        setTimeout(() => modal.classList.add('hidden'), 300);
    }

    function completeTask(taskId, points) {
        closeTaskModal();
        setTimeout(() => {
            state.points += points;
            state.tasksCompleted += 1;
            const colors = ['pink', 'purple', 'yellow', 'red'];
            state.flowers.push(colors[Math.floor(Math.random() * colors.length)]);
            
            // ç§»é™¤é€²è¡Œä¸­ï¼ŒåŠ å…¥å·²å®Œæˆ
            state.acceptedTasks = state.acceptedTasks.filter(id => id !== taskId);
            if(!state.completedTaskIds) state.completedTaskIds = [];
            state.completedTaskIds.push(taskId);
            
            saveState(); // å­˜æª”

            document.getElementById('success-points').innerText = points;
            
            const successModal = document.getElementById('modal-success');
            const successContent = document.getElementById('success-content');
            successModal.classList.remove('hidden');
            requestAnimationFrame(() => successContent.classList.remove('scale-90'));
            
            // éš±è—åœ°åœ–ä¸Šçš„ Pin
            const pin = document.querySelector(`.map-pin[onclick="openTaskModal('${taskId}')"]`);
            if(pin) pin.style.display = 'none';

            updateUI();
        }, 1000);
    }

    function closeSuccessModal() {
         const successModal = document.getElementById('modal-success');
         successModal.classList.add('hidden');
         goToPage('page-garden'); 
    }
    
    function updateMapPins() {
        const pins = document.querySelectorAll('.map-pin');
        pins.forEach(pin => {
            const taskId = pin.getAttribute('onclick').match(/'([^']+)'/)[1];
            pin.classList.remove('active');
            const existingLabel = pin.querySelector('.task-label');
            if(existingLabel) existingLabel.style.display = 'none';
            
            // å¦‚æœå·²å®Œæˆï¼Œç›´æ¥éš±è—
            if (state.completedTaskIds && state.completedTaskIds.includes(taskId)) {
                pin.style.display = 'none';
                return;
            }

            if (state.acceptedTasks.includes(taskId)) {
                pin.classList.add('active');
                if(!existingLabel) {
                     const label = document.createElement('span');
                     label.className = 'task-label';
                     label.innerText = 'ä»»å‹™åŸ·è¡Œä¸­';
                     pin.appendChild(label);
                } else {
                    existingLabel.style.display = 'block';
                }
            }
        });
    }


    // --- ç¤¾ç¾¤åŠŸèƒ½ ---
    function addPost() {
        const input = document.getElementById('post-input');
        if(!input.value.trim()) return;
        
        const list = document.getElementById('feed-list');
        const newPost = document.createElement('div');
        newPost.className = 'bg-white p-4 rounded-2xl shadow-sm animate-grow origin-top';
        newPost.innerHTML = `
            <div class="flex justify-between items-start mb-2">
                <div class="flex items-center gap-2">
                    <div class="app-logo-avatar flex-shrink-0"><i class="fa-solid fa-seedling"></i></div>
                    <div>
                        <p class="font-bold text-sm">NCUEfreshman</p>
                        <p class="text-xs text-gray-400">å‰›å‰›</p>
                    </div>
                </div>
            </div>
            <p class="text-gray-700 text-sm mb-3">${input.value}</p>
            <div class="flex items-center gap-4 text-gray-500 text-sm border-t border-gray-50 pt-3">
                <button onclick="toggleLike(this)" class="flex items-center gap-1 hover:text-red-500 transition"><i class="fa-regular fa-heart"></i> <span>0</span></button>
                <button onclick="showSimpleAlert('ç•™è¨€åŠŸèƒ½é–‹ç™¼ä¸­ï¼')" class="flex items-center gap-1 hover:text-blue-500 transition"><i class="fa-regular fa-comment"></i> <span>0</span></button>
            </div>
        `;
        list.prepend(newPost);
        input.value = '';
    }

    function toggleLike(btn) {
        const icon = btn.querySelector('i');
        const count = btn.querySelector('span');
        let num = parseInt(count.innerText);
        
        if (icon.classList.contains('fa-regular')) {
            icon.classList.replace('fa-regular', 'fa-solid');
            icon.classList.add('text-red-500');
            count.innerText = num + 1;
        } else {
            icon.classList.replace('fa-solid', 'fa-regular');
            icon.classList.remove('text-red-500');
            count.innerText = num - 1;
        }
    }
    
    // --- ç•™è¨€åŠŸèƒ½ ---
    function openComments(postId) {
        currentPostId = postId; 
        const modal = document.getElementById('modal-comments');
        const list = document.getElementById('comments-list');
        list.innerHTML = ''; 
        
        const comments = postComments[postId] || [];
        comments.forEach(c => {
            const div = document.createElement('div');
            div.className = 'flex gap-3 animate-fade-in-up';
            div.innerHTML = `
                 <div class="app-logo-avatar w-8 h-8 flex-shrink-0 text-sm"><i class="fa-solid fa-user"></i></div>
                <div class="bg-gray-50 p-3 rounded-xl rounded-tl-none text-sm">
                    <p class="font-bold text-gray-800 mb-1">${c.user}</p>
                    <p class="text-gray-600">${c.content}</p>
                </div>
            `;
            list.appendChild(div);
        });
        
        modal.classList.remove('hidden');
    }
    
    function closeCommentsModal() {
        document.getElementById('modal-comments').classList.add('hidden');
        currentPostId = '';
    }
    
    function sendComment() {
        const input = document.getElementById('comment-input');
        if(!input.value.trim()) return;
        
        const list = document.getElementById('comments-list');
        const newComment = document.createElement('div');
        newComment.className = 'flex gap-3 animate-fade-in-up';
        newComment.innerHTML = `
            <div class="app-logo-avatar w-8 h-8 flex-shrink-0 text-sm"><i class="fa-solid fa-seedling"></i></div>
            <div class="bg-gray-50 p-3 rounded-xl rounded-tl-none text-sm">
                <p class="font-bold text-gray-800 mb-1">NCUEfreshman</p>
                <p class="text-gray-600">${input.value}</p>
            </div>
        `;
        list.appendChild(newComment);
        
        if(currentPostId) {
             if(!postComments[currentPostId]) postComments[currentPostId] = [];
             postComments[currentPostId].push({ user: 'NCUEfreshman', content: input.value });
        }

        input.value = '';
        list.scrollTop = list.scrollHeight;
    }

    // --- ç¯©é¸å½ˆçª— ---
    function openFilterModal() {
        document.getElementById('modal-filter').classList.remove('hidden');
    }
    function closeFilterModal() {
        document.getElementById('modal-filter').classList.add('hidden');
    }

    // --- é›œé … & æè´ˆ ---
    function checkInMood(btn) {
        if (state.hasCheckedIn) return;
        
        btn.style.transform = 'scale(0.8)';
        setTimeout(() => {
            btn.style.transform = 'scale(1)';
            showSimpleAlert('ç°½åˆ°æˆåŠŸï¼ç²å¾— 5 ç©åˆ†');
            state.points += 5;
            state.hasCheckedIn = true; 
            saveState(); // å­˜æª”
            updateUI();
        }, 200);
    }

    function redeemItem(cost, name) {
        if (state.points >= cost) {
            state.points -= cost;
            saveState(); // å­˜æª”
            updateUI();
            showSimpleAlert(`æˆåŠŸå…Œæ›ï¼š${name}`);
        } else {
            showSimpleAlert('ç©åˆ†ä¸è¶³ï¼');
        }
    }

    function openDonateModal() {
        document.getElementById('donate-modal-points').innerText = state.points;
        document.getElementById('modal-donate').classList.remove('hidden');
        document.getElementById('donate-input-area').classList.add('hidden');
        document.querySelectorAll('.npo-option').forEach(el => el.classList.remove('border-teal-500', 'bg-teal-50'));
        selectedNPO = '';
    }
    
    function closeDonateModal() {
        document.getElementById('modal-donate').classList.add('hidden');
    }
    
    function selectNPO(btn, name) {
        document.querySelectorAll('.npo-option').forEach(el => el.classList.remove('border-teal-500', 'bg-teal-50'));
        btn.classList.add('border-teal-500', 'bg-teal-50');
        selectedNPO = name;
        document.getElementById('donate-input-area').classList.remove('hidden');
    }

    function confirmDonation() {
        const amountInput = document.getElementById('donate-amount');
        const amount = parseInt(amountInput.value);
        
        if (!amount || amount <= 0) {
            showSimpleAlert('è«‹è¼¸å…¥æœ‰æ•ˆé‡‘é¡');
            return;
        }
        if (amount > state.points) {
            showSimpleAlert('ç©åˆ†ä¸è¶³ï¼');
            return;
        }
        
        state.points -= amount;
        saveState(); // å­˜æª”
        updateUI();
        closeDonateModal();
        showSimpleAlert(`æ„Ÿè¬ï¼å·²æè´ˆ ${amount} ç©åˆ†çµ¦ ${selectedNPO}ã€‚`);
        amountInput.value = ''; 
    }
    
    function copyInviteCode() {
        showSimpleAlert('å·²è¤‡è£½é‚€è«‹ç¢¼ï¼šB9F53A');
    }

    function showSimpleAlert(message) {
        const alertBox = document.createElement('div');
        alertBox.className = 'fixed top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg text-sm font-medium z-50 animate-fade-in-up';
        alertBox.innerText = message;
        document.body.appendChild(alertBox);
        setTimeout(() => {
            alertBox.style.opacity = '0';
            setTimeout(() => alertBox.remove(), 300);
        }, 2000);
    }

    function shareApp() {
        const shareData = {
            title: 'CivicGo 3.0 - è®“æ”¹è®Šå¾å··å£é–‹å§‹',
            text: 'æˆ‘åœ¨ç”¨ CivicGo åš 10 åˆ†é˜å°±èƒ½å®Œæˆçš„åŸå¸‚ä»»å‹™ï¼Œä¸€èµ·ä¾†è©¦è©¦çœ‹ï¼',
            url: window.location.href
        };

        if (navigator.share) {
            navigator.share(shareData).catch((err) => {
                console.log('åˆ†äº«å–æ¶ˆæˆ–å¤±æ•—ï¼š', err);
            });
        } else if (navigator.clipboard) {
            navigator.clipboard.writeText(shareData.url)
                .then(() => {
                    showSimpleAlert('å·²è¤‡è£½åˆ†äº«é€£çµï¼Œè²¼çµ¦æœ‹å‹å°±å¯ä»¥äº†ï¼');
                })
                .catch(() => {
                    showSimpleAlert('è¤‡è£½ç¶²å€å¤±æ•—ï¼Œè«‹æ”¹ç”¨ç€è¦½å™¨çš„åˆ†äº«åŠŸèƒ½ã€‚');
                });
        } else {
            showSimpleAlert('æ‚¨çš„è£ç½®ä¸æ”¯æ´ç³»çµ±åˆ†äº«ï¼Œè«‹ç›´æ¥è¤‡è£½ç¶²å€åˆ†äº«çµ¦æœ‹å‹ã€‚');
        }
    }

    function showPartnerInfo(name, desc) {
        const alertBox = document.createElement('div');
        alertBox.className = 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-6';
        alertBox.innerHTML = `
            <div class="bg-white rounded-2xl p-6 w-full max-w-sm animate-grow">
                <h3 class="text-xl font-bold text-gray-800 mb-2">${name}</h3>
                <p class="text-gray-600 mb-6">${desc}</p>
                <button class="w-full bg-teal-500 text-white font-bold py-3 rounded-xl" onclick="this.parentElement.parentElement.remove()">é—œé–‰</button>
            </div>
        `;
        document.body.appendChild(alertBox);
    }

    function submitCSR() {
        const id = document.getElementById('csr-id').value;
        if(id) {
            showSimpleAlert('ç”³è«‹å·²é€å‡ºï¼æˆ‘å€‘å°‡ç›¡å¿«å¯©æ ¸ã€‚');
        } else {
            showSimpleAlert('è«‹è¼¸å…¥ä¼æ¥­çµ±ç·¨');
        }
    }
    
    function toggleFaq(btn) {
        btn.parentElement.classList.toggle('active');
    }

    function toggleNotificationModal() {
        const modal = document.getElementById('modal-notification');
        if(modal.classList.contains('hidden')) {
            modal.classList.remove('hidden');
        } else {
            modal.classList.add('hidden');
        }
    }

    // åˆå§‹åŒ–ï¼šå…ˆè®€å–å­˜æª”ï¼Œå†æ›´æ–°ä»‹é¢
    loadState();
    updateUI();
</script>


</body>
</html>

