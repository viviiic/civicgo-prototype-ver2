<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicGo äº’å‹•åŸå‹ (ç°¡åŒ–ç‰ˆ)</title>
    <!-- è¼‰å…¥ Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Inter å­—å‹ --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- è¼‰å…¥ Font Awesome åœ–ç¤ºåº« --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            background-color: #E5E7EB; /* é é¢èƒŒæ™¯è‰² */
        }
        /* æ¨¡æ“¬æ‰‹æ©Ÿå¤–æ¡† */
        .mobile-shell {
            width: 414px; 
            max-width: 100%; 
            aspect-ratio: 9 / 16; 
            max-height: 90vh; 
            border-radius: 2.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            background-color: #f7fafc;
            display: flex;
            flex-direction: column;
        }
        .mobile-content {
             width: 100%;
             height: 100%;
             flex-grow: 1;
             display: flex;
             flex-direction: column;
             overflow: hidden; 
        }
        /* æ¨¡æ“¬ LINE MINI App çš„é ‚éƒ¨å°èˆªåˆ— */
        .mini-app-header {
            background-color: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0; 
        }
        /* éš±è—/é¡¯ç¤ºç•«é¢çš„ class */
        .page {
            display: none; 
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%; 
            flex-direction: column;
        }
        .page.active {
            display: flex; 
        }
        /* ä»»å‹™åœ–é‡˜çš„æ¨£å¼ */
        .task-pin {
            position: absolute;
            transform: translate(-50%, -50%); 
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid;
            backdrop-filter: blur(4px);
        }

        /* æ–°å¢ï¼šä»»å‹™åŸ·è¡Œä¸­æ¨™ç±¤ */
        .task-label {
            display: none; /* é è¨­éš±è— */
            position: absolute;
            top: 100%; /* åœ–é‡˜ä¸‹æ–¹ */
            left: 50%;
            transform: translateX(-50%);
            margin-top: 6px; /* å¾€ä¸‹æ¨ 6px */
            background-color: #16A34A; /* ç¶ è‰² */
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            white-space: nowrap; /* ç¢ºä¿ "ä»»å‹™åŸ·è¡Œä¸­" ä¸æœƒæ›è¡Œ */
            z-index: 10; /* ç¢ºä¿åœ¨å…¶ä»–æ±è¥¿ä¹‹ä¸Š */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .task-pin:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        /* æ–°å¢ï¼šä»»å‹™é€²è¡Œä¸­ (é–ƒçˆ) */
        .task-pin.active {
            /* ä½¿ç”¨ Tailwind çš„ green-600: #16A34A */
            animation: pulse 1.5s infinite;
        }
        /* æ–°å¢ï¼šActive æ™‚é¡¯ç¤ºæ¨™ç±¤ */
        .task-pin.active .task-label {
            display: block;
        }

        /* è† å›Šå¼åˆ†é æŒ‰éˆ•çš„è½‰å ´æ•ˆæœ */
        .tab-btn {
             transition: all 0.3s ease; /* ç§»é™¤ @apply */
        }

        .tab-panel {
            display: none; /* é è¨­éš±è— */
        }
        .tab-panel.active {
            display: block; /* é¡¯ç¤ºé¸ä¸­çš„åˆ†é  */
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7);
            }
            70% {
                box-shadow: 0 0 0 12px rgba(22, 163, 74, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(22, 163, 74, 0);
            }
        }
        /* åº•éƒ¨å½ˆçª— */
        .bottom-sheet {
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        /* åŸå¸‚èŠ±åœ’çš„èŠ±æœµ */
        .flower {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s ease-out;
        }
        .flower.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        /* åº•éƒ¨å°èˆªåˆ—æ¨£å¼ */
        .bottom-nav {
            flex-shrink: 0; 
            height: 65px; 
            padding-top: 8px;
            padding-bottom: 8px;
        }
        
        /* åº•éƒ¨å°èˆªæŒ‰éˆ• (å·¦å³) - ä¿®æ”¹ç‚º 5 å€‹é …ç›® */
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 20%; /* 1/5 å¯¬åº¦ */
            padding-top: 0.25rem; /* pt-1 */
        }


        /* èŠ±åœ’èƒŒæ™¯æ¼¸è®Š (å¤©ç©ºèª¿äº®) */
        .garden-bg-gradient {
            background: linear-gradient(to bottom, #ADD8E6, #C1E5F0); /* æ·ºè—è‰²å¤©ç©ºæ¼¸è®Š (æ›´äº®) */
        }
    </style>
</head>
<body>

    <!-- æ¨¡æ“¬æ‰‹æ©Ÿå¤–æ¡† --><div class="mobile-shell">
        <div class="mobile-content"> 

            <!-- 
                ============================================================
                ç•«é¢ 1: å•Ÿå‹•ç•«é¢ (Splash Screen) & LINE Login
                ============================================================
            --><div id="page-splash" class="page active bg-white items-center justify-center text-center p-8 space-y-8">
                <div class="flex flex-col items-center">
                    <i class="fa-solid fa-map-location-dot fa-4x text-green-500"></i>
                    <h1 class="text-3xl font-bold text-gray-800 mt-4">CivicGo</h1>
                    <p class="text-lg text-gray-600 mt-2">è®“æ”¹è®Šï¼Œå¾å··å£é–‹å§‹</p>
                </div>
                
                <div class="w-full absolute bottom-16 left-0 px-8">
                    <!-- ä¿®æ”¹ï¼šç™»å…¥å¾Œå‰å¾€ä¸»é  -->
                    <button onclick="goToPage('page-home')" class="w-full bg-[#06C755] text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:bg-[#05b34b] transition-colors flex items-center justify-center space-x-2">
                        <i class="fa-brands fa-line fa-lg"></i>
                        <span>ä½¿ç”¨ LINE ç™»å…¥</span>
                    </button>
                    <p class="text-xs text-gray-500 mt-4 text-center">ç™»å…¥å³è¡¨ç¤ºæ‚¨åŒæ„æˆ‘å€‘çš„æœå‹™æ¢æ¬¾ã€‚</p>
                </div>
            </div>

            <!-- 
                ============================================================
                ç•«é¢ 2: ä¸»ç•«é¢ (åœ°åœ–ä»»å‹™)
                ============================================================
            --><div id="page-map" class="page">
                <!-- æ¨¡æ“¬ LINE MINI App é ‚éƒ¨ --><div class="mini-app-header w-full p-4 flex items-center justify-between shadow-sm">
                    <h1 class="text-xl font-bold text-gray-800">CivicGo</h1>
                    <!-- å³ä¸Šè§’æŒ‰éˆ•å·²ç§»é™¤ -->
                    <span class="w-10 h-10"></span> <!-- ä½”ä½ç¬¦ä¿æŒæ¨™é¡Œç½®ä¸­ -->
                </div>
                
                <!-- åœ°åœ–å€åŸŸ - ä½¿ç”¨ SVG ç¤ºæ„åœ– --><div class="flex-grow relative w-full overflow-hidden bg-gray-200">
                    <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600">
                        <!-- åŸºç¤åº•è‰² (æ·ºç±³è‰²) --><rect x="0" y="0" width="400" height="600" fill="#F5F3EF" />
                        
                        <!-- é“è·¯ (ä¸­ç°è‰²) --><rect x="150" y="0" width="60" height="600" fill="#CBD5E1" /> <!-- å‚ç›´ä¸»è¦é“è·¯ --><rect x="0" y="250" width="400" height="60" fill="#CBD5E1" /> <!-- æ°´å¹³ä¸»è¦é“è·¯ --><rect x="0" y="450" width="400" height="40" fill="#E2E8F0" /> <!-- æ°´å¹³å°è·¯ --><rect x="300" y="0" width="40" height="250" fill="#E2E8F0" /> <!-- å‚ç›´å°è·¯ --><!-- é“è·¯ä¸­å¿ƒç·š --><path d="M 170 0 V 600" stroke="#FFFFFF" stroke-width="2" stroke-dasharray="10 10" fill="none"/>
                        <path d="M 190 0 V 600" stroke="#FFFFFF" stroke-width="2" stroke-dasharray="10 10" fill="none"/>
                        <path d="M 0 270 H 400" stroke="#FFFFFF" stroke-width="2" stroke-dasharray="10 10" fill="none"/>
                        <path d="M 0 290 H 400" stroke="#FFFFFF" stroke-width="2" stroke-dasharray="10 10" fill="none"/>

                        <!-- ç¶ åœ° (å…¬åœ’) --><rect x="230" y="330" width="150" height="100" fill="#C6F6D5" /> <!-- å³ä¸‹å…¬åœ’ --><rect x="20" y="20" width="110" height="210" fill="#D1FAE5" /> <!-- å·¦ä¸Šå…¬åœ’ --><!-- å»ºç¯‰ç‰© (æ·±ç° & ä¸åŒè‰²èª¿) --><rect x="230" y="20" width="50" height="80" fill="#9CA3AF" />
                        <rect x="230" y="120" width="50" height="110" fill="#A0AEC0" />
                        
                        <rect x="360" y="20" width="20" height="210" fill="#A0AEC0" />

                        <rect x="20" y="330" width="110" height="100" fill="#9CA3AF" />
                        <rect x="20" y="510" width="110" height="70" fill="#A0AEC0" />
                        <rect x="230" y="510" width="150" height="70" fill="#9CA3AF" />
                        
                        <!-- å…¬åœ’è£¡çš„æ¨¹ (åœ“å½¢) --><circle cx="50" cy="50" r="10" fill="#4ADE80" opacity="0.8"/>
                        <circle cx="80" cy="80" r="15" fill="#34D399" opacity="0.8"/>
                        <circle cx="100" cy="150" r="12" fill="#4ADE80" opacity="0.8"/>
                        <circle cx="40" cy="200" r="10" fill="#34D399" opacity="0.8"/>
                        <circle cx="250" cy="360" r="10" fill="#4ADE80" opacity="0.8"/>
                        <circle cx="280" cy="400" r="15" fill="#34D399" opacity="0.8"/>
                        <circle cx="340" cy="380" r="12" fill="#4ADE80" opacity="0.8"/>
                    </svg>
                    
                    <!-- ä½¿ç”¨è€…ç•¶å‰ä½ç½® --><div class="absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-md"></div>
                        <div class="w-4 h-4 bg-blue-500 rounded-full absolute top-0 left-0 animate-ping"></div>
                    </div>

                    <!-- ä»»å‹™åœ–é‡˜ 1: æ’¿åƒåœ¾ --><div id="pin-task1" class="task-pin border-red-500" style="top: 45%; left: 40%;" onclick="showTaskDetail('task1')">
                        <i class="fa-solid fa-trash-can fa-lg text-red-700"></i>
                        <span class="task-label">ä»»å‹™åŸ·è¡Œä¸­</span>
                    </div>

                    <!-- ä»»å‹™åœ–é‡˜ 2: æäºŒæ‰‹æ›¸ --><div id="pin-task2" class="task-pin border-blue-500" style="top: 60%; left: 65%;" onclick="showTaskDetail('task2')">
                        <i class="fa-solid fa-book fa-lg text-blue-700"></i>
                        <span class="task-label">ä»»å‹™åŸ·è¡Œä¸­</span>
                    </div>

                    <!-- ä»»å‹™åœ–é‡˜ 3: å‹Ÿé›†å†¬è¡£ --><div id="pin-task3" class="task-pin border-yellow-500" style="top: 25%; left: 55%;" onclick="showTaskDetail('task3')">
                        <i class="fa-solid fa-shirt fa-lg text-yellow-700"></i>
                        <span class="task-label">ä»»å‹™åŸ·è¡Œä¸­</span>
                    </div>

                    <!-- æ–°å¢ï¼šç™¼å¸ƒéœ€æ±‚ (FAB) --><button onclick="goToPage('page-community-post')" class="absolute bottom-6 right-6 w-16 h-16 bg-green-500 text-white rounded-full flex items-center justify-center shadow-lg z-20">
                        <i class="fa-solid fa-plus fa-2x"></i>
                    </button>
                </div>
                
                <!-- åº•éƒ¨å°èˆª (å…¨æ–° 5 é …ç›®çµæ§‹) --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top">
                    <!-- 1. ä¸»é  -->
                    <button onclick="goToPage('page-home')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-house"></i>
                        <span class="text-xs mt-1">ä¸»é </span>
                    </button>
                    <!-- 2. ç¤¾ç¾¤ -->
                    <button onclick="goToPage('page-community-feed')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-users"></i>
                        <span class="text-xs mt-1">ç¤¾ç¾¤</span>
                    </button>
                    <!-- 3. åœ°åœ– (ç•¶å‰é ) -->
                    <button onclick="goToPage('page-map')" class="bottom-nav-item text-green-600">
                        <i class="fa-solid fa-map-location-dot"></i>
                        <span class="text-xs font-semibold mt-1">åœ°åœ–</span>
                    </button>
                    <!-- 4. çå‹µ -->
                    <button onclick="goToPage('page-rewards')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-gift"></i>
                        <span class="text-xs mt-1">çå‹µ</span>
                    </button>
                    <!-- 5. å€‹äºº -->
                    <button onclick="goToPage('page-garden')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-user"></i>
                        <span class="text-xs mt-1">å€‹äºº</span>
                    </button>
                </div>
            </div>

            <!-- 
                ============================================================
                ç•«é¢ 3: ä»»å‹™è©³æƒ… (åº•éƒ¨å½ˆçª—)
                ============================================================
            --><div id="modal-task-detail" class="page" style="display: none; background-color: rgba(0,0,0,0.5);" onclick="closeModal('modal-task-detail')">
                <div class="w-full bg-white rounded-t-2xl p-6 absolute bottom-0 bottom-sheet max-h-[70%] flex flex-col" onclick="event.stopPropagation()">
                    <div id="task-detail-content" class="overflow-y-auto"></div>
                    <div class="mt-6 flex space-x-4 flex-shrink-0">
                        <button onclick="closeModal('modal-task-detail')" class="w-1/3 bg-gray-200 text-gray-700 font-semibold py-3 rounded-lg">å†çœ‹çœ‹</button>
                        <button id="accept-task-btn" class="w-2/3 bg-green-500 text-white font-semibold py-3 rounded-lg shadow-lg hover:bg-green-600 transition-colors">
                            æ¥å—ä»»å‹™
                        </button>
                    </div>
                </div>
            </div>

            <!-- 
                ============================================================
                ç•«é¢ 4: ä»»å‹™é©—è­‰ (æ¨¡æ“¬ç›¸æ©Ÿ)
                ============================================================
            --><div id="page-validation" class="page bg-gray-900 items-center justify-center text-white p-4">
                
                <!-- é©—è­‰ä¸­è®€å–ç•«é¢ --><div id="ai-verifying" class="absolute inset-0 bg-gray-900/90 backdrop-blur-sm flex-col items-center justify-center" style="display: none; z-index: 20;">
                    <p class="mt-4 text-gray-200 font-semibold text-lg">ğŸ“¸ æ­£åœ¨é©—è­‰æ‚¨çš„è²¢ç»...</p>
                </div>

                <!-- æ‹ç…§ä»‹é¢ --><div class="w-full text-center absolute top-16">
                    <h2 class="text-2xl font-semibold">ä»»å‹™é©—è­‰</h2>
                    <p id="validation-instruction" class="text-lg text-gray-300 mt-2">è«‹æ‹æ”æ‚¨æ”¶é›†çš„åƒåœ¾è¢‹</p>
                </div>
                
                <div class="w-full aspect-square bg-gray-700 rounded-lg flex items-center justify-center text-gray-500">
                    <i class="fa-solid fa-camera fa-7x"></i>
                </div>

                <div class="w-full absolute bottom-16 left-0 px-8 flex justify-around items-center">
                    <button onclick="goToPage('page-map')" class="text-white font-medium">å–æ¶ˆ</button>
                    <button onclick="startAIVerification()" class="w-20 h-20 bg-white rounded-full border-4 border-gray-300 shadow-xl"></button>
                    <button class="text-white font-medium opacity-0">åˆ‡æ›</button>
                </div>
            </div>

            <!-- 
                ============================================================
                ç•«é¢ 5: ä»»å‹™æˆåŠŸ - åˆ†äº«è‡³ VOOM
                ============================================================
            --><div id="page-success" class="page bg-white items-center text-center p-8 pt-24 space-y-6">
                <i class="fa-solid fa-circle-check fa-7x text-green-500"></i>
                
                <h1 class="text-3xl font-bold text-gray-800">ä»»å‹™å®Œæˆï¼</h1>
                <p class="text-lg text-gray-600">æ­å–œï¼æ‚¨ç²å¾—äº† <span id="reward-points" class="font-bold text-green-600"></span> é»ç©åˆ†ã€‚</p>
                <!-- ç§»é™¤äº†é‡ç–Šçš„åœ–ç‰‡ï¼Œä¿ç•™æ–‡å­— --><p class="text-lg font-semibold text-gray-700">æ‚¨çš„ã€ŒåŸå¸‚èŠ±åœ’ã€é•·å‡ºäº†ä¸€æœµæ–°çš„èŠ±ï¼</p>
                
                <div class="w-full absolute bottom-16 left-0 px-8 space-y-4">
                    <button onclick="goToPage('page-garden')" class="w-full bg-green-500 text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:bg-green-600 transition-colors">
                        æŸ¥çœ‹æˆ‘çš„èŠ±åœ’
                    </button>
                    <button onclick="showSimpleAlert('å·²åˆ†äº«è‡³ LINE VOOM (æ¨¡æ“¬)')" class="w-full bg-white text-[#06C755] border-2 border-[#06C755] font-semibold py-3 px-6 rounded-lg flex items-center justify-center space-x-2">
                        <i class="fa-brands fa-line fa-lg"></i>
                        <span>åˆ†äº«è‡³ LINE VOOM</span>
                    </button>
                    <button onclick="goToPage('page-map')" class="w-full bg-gray-100 text-gray-700 font-semibold py-3 px-6 rounded-lg">
                        å°‹æ‰¾ä¸‹ä¸€å€‹ä»»å‹™
                    </button>
                </div>
            </div>
            
            <!-- 
                ============================================================
                ç•«é¢ 6: å€‹äººä¸­å¿ƒ (page-garden) - æ ¹æ“šæˆªåœ–å¤§æ”¹ç‰ˆ
                ============================================================
            --><div id="page-garden" class="page bg-gray-50">
                <!-- é ‚éƒ¨å°èˆª --><div class="mini-app-header w-full p-4 flex items-center shadow-sm">
                    <!-- ç§»é™¤è¿”å›æŒ‰éˆ• -->
                    <h1 class="text-xl font-bold text-gray-800 text-center flex-grow">å€‹äººä¸­å¿ƒ</h1>
                </div>

                <!-- å¯æ²å‹•çš„ wrapper --><div class="flex-grow overflow-y-auto p-6 space-y-6"> <!-- ç§»é™¤ pb-16 -->

                    <!-- æ–°ï¼šå€‹äººè³‡æ–™å¡ (å« XP) --><div class="bg-white rounded-lg shadow-lg p-5">
                        <div class="flex items-center space-x-4">
                            <img src="https://placehold.co/64x64/c6f6d5/2f855a?text=You" alt="Your Avatar" class="w-16 h-16 rounded-full border-2 border-green-200">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">NCUEfreshman</h2>
                                <p class="font-semibold text-green-600">LV 1 æ–°æ‰‹å…¬æ°‘</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm font-medium text-gray-600 mb-1">
                                <span>XP</span>
                                <span>10 / 50</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-green-500 h-2.5 rounded-full" style="width: 20%"></div> <!-- æ¨¡æ“¬ 20% XP -->
                            </div>
                        </div>
                    </div>

                    <!-- æ–°ï¼šå››æ ¼çµ±è¨ˆç‰ˆ --><div class="bg-white rounded-lg shadow-lg p-4">
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <!-- ç¸½ç©åˆ† -->
                            <div class="p-2">
                                <p class="text-sm text-gray-500">ç¸½ç©åˆ†</p>
                                <p id="garden-total-points" class="text-3xl font-bold text-green-600">0</p>
                            </div>
                            <!-- å·²å®Œæˆä»»å‹™ -->
                            <div class="p-2">
                                <p class="text-sm text-gray-500">å·²å®Œæˆä»»å‹™</p>
                                <p id="garden-tasks-completed" class="text-3xl font-bold text-gray-800">0</p>
                            </div>
                            <!-- ä¿¡ç”¨ç©åˆ† -->
                            <div class="p-2">
                                <p class="text-sm text-gray-500">ä¿¡ç”¨ç©åˆ†</p>
                                <p id="garden-trust-score" class="text-3xl font-bold text-blue-600">100</p>
                            </div>
                            <!-- å·²é‚€è«‹ -->
                            <div class="p-2">
                                <p class="text-sm text-gray-500">å·²é‚€è«‹</p>
                                <p class="text-3xl font-bold text-gray-800">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ä¿ç•™ï¼šèŠ±åœ’è¦–è¦ºåŒ– --><div class="p-6 pt-0 flex flex-col items-center justify-center bg-green-50 rounded-2xl m-0 shadow-inner">
                        <p class="w-full text-center text-lg font-semibold text-gray-700 mb-4 mt-6">NCUEfreshmançš„èŠ±åœ’</p>
                        <div class="w-full h-64 rounded-lg flex items-end justify-center space-x-4 overflow-hidden relative p-4 garden-bg-gradient">
                            
                            <svg class="absolute bottom-0 left-0 w-full h-32 z-20" viewBox="0 0 400 128" preserveAspectRatio="none" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- æ·ºè‰²è‰åœ° (å‰æ™¯) --><rect x="0" y="48" width="400" height="80" fill="#22C55E"/>
                                <!-- æ·±è‰²è‰åœ° (èƒŒæ™¯) ç¨é«˜ä¸€é» --><rect x="0" y="0" width="400" height="80" fill="#15803D" opacity="0.8"/>
                            </svg>

                            <div id="flower-container" class="relative z-30 flex items-end h-full w-full justify-around"> 
                                <!-- èŠ±æœµæœƒè¢« JS åŠ åˆ°é€™è£¡ --></div>
                        </div>
                    </div>

                    <!-- æ–°å¢ï¼šæˆ‘çš„æˆ°ç¸¾ (ä»¿æˆªåœ–) --><div class="bg-white rounded-lg shadow-lg p-5">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">æˆ‘çš„æˆ°ç¸¾</h3>
                        <div class="space-y-4">
                            <!-- æœ¬æœˆæˆ°ç¸¾ -->
                            <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm font-semibold text-red-600 bg-red-100 px-3 py-1 rounded-full">æœ¬æœˆ</span>
                                <p class="text-gray-700">å·²å®Œæˆ <span class="font-bold text-lg text-gray-900">0</span> é …ä»»å‹™</p>
                            </div>
                            <!-- æœ¬å¹´æˆ°ç¸¾ -->
                            <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                                <span class="text-sm font-semibold text-blue-600 bg-blue-100 px-3 py-1 rounded-full">æœ¬å¹´</span>
                                <p class="text-gray-700">å·²å®Œæˆ <span class="font-bold text-lg text-gray-900">0</span> é …ä»»å‹™</p>
                            </div>
                        </div>
                    </div>

                    <!-- æ–°å¢ï¼šé‚€è«‹å¤¥ä¼´ (ä»¿æˆªåœ–) --><div class="bg-white rounded-lg shadow-lg p-5">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg font-semibold text-gray-800">é‚€è«‹å¤¥ä¼´</h3>
                            <img src="https://placehold.co/80x40/f0f9ff/0284c7?text=Invite" alt="é‚€è«‹ç¤ºæ„åœ–" class="rounded">
                        </div>
                        <p class="text-sm text-gray-600 mb-3">é‚€è«‹å¥½å‹åŠ å…¥ï¼Œä½ å€‘éƒ½èƒ½ç²å¾—ç©åˆ†çå‹µï¼</p>
                        <div class="flex items-center justify-between bg-gray-100 p-3 rounded-lg">
                            <span class="text-gray-700 font-medium">æˆ‘çš„é‚€è«‹ç¢¼: <span class="font-bold text-lg text-black tracking-wider ml-2">B9F53A</span></span>
                            <button onclick="showSimpleAlert('å·²è¤‡è£½é‚€è«‹ç¢¼ B9F53A')" class="p-2 text-gray-600 hover:text-green-600">
                                <i class="fa-solid fa-copy fa-lg"></i>
                            </button>
                        </div>
                    </div>
                
                </div> <!-- çµæŸå¯æ²å‹•çš„ wrapper -->
                
                <!-- åº•éƒ¨å°èˆª (å…¨æ–° 5 é …ç›®çµæ§‹) --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top"> <!-- ç§»é™¤ fixed å’Œ style -->
                    <!-- 1. ä¸»é  -->
                    <button onclick="goToPage('page-home')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-house"></i>
                        <span class="text-xs mt-1">ä¸»é </span>
                    </button>
                    <!-- 2. ç¤¾ç¾¤ -->
                    <button onclick="goToPage('page-community-feed')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-users"></i>
                        <span class="text-xs mt-1">ç¤¾ç¾¤</span>
                    </button>
                    <!-- 3. åœ°åœ– -->
                    <button onclick="goToPage('page-map')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-map-location-dot"></i>
                        <span class="text-xs mt-1">åœ°åœ–</span>
                    </button>
                    <!-- 4. çå‹µ -->
                    <button onclick="goToPage('page-rewards')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-gift"></i>
                        <span class="text-xs mt-1">çå‹µ</span>
                    </button>
                    <!-- 5. å€‹äºº (ç•¶å‰é ) -->
                    <button onclick="goToPage('page-garden')" class="bottom-nav-item text-green-600">
                        <i class="fa-solid fa-user"></i>
                        <span class="text-xs font-semibold mt-1">å€‹äºº</span>
                    </button>
                </div>
            </div>

            <!-- 
                ============================================================
                ç•«é¢ 7: ç¤¾å€ç«¯ (ç™¼å¸ƒéœ€æ±‚) - æ”¹ç‚ºå­é é¢
                ============================================================
            --><div id="page-community-post" class="page"> 
                
                <div class="mini-app-header w-full p-4 flex items-center shadow-sm">
                    <!-- æ–°å¢ï¼šè¿”å›æŒ‰éˆ• -->
                    <button onclick="goToPage('page-map')" class="p-2 text-gray-600">
                        <i class="fa-solid fa-chevron-left fa-lg"></i>
                    </button>
                    <h1 class="text-xl font-bold text-gray-800 text-center flex-grow">ç™¼å¸ƒç¤¾å€éœ€æ±‚</h1>
                    <span class="w-10 h-10"></span> <!-- ä½”ä½ç¬¦ä¿æŒæ¨™é¡Œç½®ä¸­ -->
                </div>

                <div class="flex-grow overflow-y-auto p-6"> 

                    <!-- æ­¥é©Ÿ 2 æ”¹ç‚ºé è¨­é¡¯ç¤º --><div id="manual-form-step">
                        <form onsubmit="event.preventDefault(); showCommunitySuccess();">
                                <div class="space-y-4">
                                    <div>
                                        <label for="task-title" class="text-sm font-medium text-gray-700">ä»»å‹™æ¨™é¡Œ</label>
                                        <input type="text" id="task-title" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼šâœ¨ é€±æœ«æ·¨ç˜ç¥éšŠå‹å‹Ÿé›†ï¼">
                                    </div>
                                    <div>
                                        <label for="task-description" class="text-sm font-medium text-gray-700">ä»»å‹™æè¿°</label>
                                        <textarea id="task-description" rows="4" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼šæˆ‘å€‘éœ€è¦ 5 ä½å¤¥ä¼´ï¼Œå”åŠ©æ¸…ç†æµ·ç˜..."></textarea>
                                    </div>
                                    <div class="flex space-x-4">
                                        <div class="w-1/2">
                                            <label for="task-location" class="text-sm font-medium text-gray-700">ä»»å‹™åœ°é»</label>
                                            <input type="text" id="task-location" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼šé€²å¾·è·¯å®‰å…¨å³¶">
                                        </div>
                                        <div class="w-1/2">
                                            <label for="task-time" class="text-sm font-medium text-gray-700">æ—¥æœŸæ™‚é–“</label>
                                            <input type="text" id="task-time" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼š11/20 ä¸‹åˆ2é»">
                                        </div>
                                    </div>
                                    <div class="flex space-x-4">
                                        <div class="w-1/2">
                                            <label for="task-people" class="text-sm font-medium text-gray-700">éœ€æ±‚äººæ•¸</label>
                                            <input type="number" id="task-people" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼š5">
                                        </div>
                                        <div class="w-1/2">
                                            <label for="task-reward" class="text-sm font-medium text-gray-700">çå‹µç©åˆ†</gabel>
                                            <input type="number" id="task-reward" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼š50">
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="w-full bg-green-500 text-white font-semibold py-3 rounded-lg shadow-lg hover:bg-green-600 transition-colors">
                                        ç¢ºèªç™¼å¸ƒ
                                    </button>
                                </div>
                            </form>
                        </div>
                </div> 
                
                <!-- ç§»é™¤äº†æ­¤é çš„åº•éƒ¨å°èˆª -->

            </div>
            
            <!-- 
                ============================================================
                ç•«é¢ 8: ç¤¾å€è²¢ç»æ’è¡Œæ¦œ (æ­¤é é¢å·²åˆä½µåˆ° "ç¤¾ç¾¤")
                ============================================================
            -->
            <!-- èˆŠçš„ page-ranking æ•´å€‹ div å·²è¢«ç§»é™¤ -->

            <!-- 
                ============================================================
                æ–°å¢ç•«é¢ 8: ç¤¾ç¾¤ (å‹•æ…‹ + æ’è¡Œæ¦œ)
                ============================================================
            --><div id="page-community-feed" class="page bg-gray-50">
                <!-- ã€ä¿®æ”¹ã€‘é ‚éƒ¨å°èˆª (æ¨™é¡Œ + è† å›ŠæŒ‰éˆ•) --><div class="mini-app-header w-full p-4 flex flex-col shadow-sm">
                    <h1 class="text-xl font-bold text-gray-800 text-center w-full">ç¤¾ç¾¤</h1>
                    <!-- æ–°ï¼šè† å›Šå¼åˆ†é åˆ‡æ› -->
                    <div class="w-full max-w-sm mx-auto bg-gray-100 p-1.5 rounded-full flex justify-center mt-4">
                        <button id="tab-btn-feed" class="tab-btn w-1/2 py-2 rounded-full text-center font-semibold bg-white text-green-600 shadow-md" onclick="showTab('feed')">
                            <i class="fa-solid fa-images mr-1"></i> å‹•æ…‹
                        </button>
                        <button id="tab-btn-ranking" class="tab-btn w-1/2 py-2 rounded-full text-center font-semibold text-gray-600" onclick="showTab('ranking')">
                            <i class="fa-solid fa-chart-simple mr-1"></i> æ’è¡Œæ¦œ
                        </button>
                    </div>
                </div>

                <!-- å¯æ²å‹•å…§å®¹å€ -->
                <div class="flex-grow overflow-y-auto"> <!-- ç§»é™¤ pb-16 -->
                    <!-- åˆ†é  1: å‹•æ…‹ (æ–°åŠŸèƒ½) -->
                    <div id="tab-panel-feed" class="tab-panel active p-4 space-y-4">
                        <!-- ç¯„ä¾‹è²¼æ–‡ 1 -->
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <img src="https://placehold.co/40x40/fecdd3/881337?text=C" alt="Avatar" class="w-10 h-10 rounded-full">
                                <div>
                                    <p class="font-semibold text-gray-800">CivicLover123</p>
                                    <p class="text-xs text-gray-500">2 å°æ™‚å‰</p>
                                </div>
                            </div>
                            <p class="text-gray-700 mb-3">ä»Šå¤©å»é€²å¾·è·¯å¹«å¿™æ’¿åƒåœ¾äº†ï¼é›–ç„¶å¾ˆç†±ï¼Œä½†çœ‹åˆ°è¡—é“è®Šä¹¾æ·¨å°±å¥½é–‹å¿ƒï¼ğŸ¥³ #CivicGo #ç¤¾å€æœå‹™</p>
                            <img src="https://placehold.co/400x250/c6f6d5/2f855a?text=Cleaned+Street" alt="è²¼æ–‡åœ–ç‰‡" class="w-full rounded-lg object-cover">
                        </div>
                        <!-- ç¯„ä¾‹è²¼æ–‡ 2 -->
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <img src="https://placehold.co/40x40/dbeafe/1e40af?text=G" alt="Avatar" class="w-10 h-10 rounded-full">
                                <div>
                                    <p class="font-semibold text-gray-800">GreenGuardian8</p>
                                    <p class="text-xs text-gray-500">5 å°æ™‚å‰</p>
                                </div>
                            </div>
                            <p class="text-gray-700">æŠŠå®¶è£¡ç”¨ä¸åˆ°çš„äºŒæ‰‹æ›¸æçµ¦åœ–æ›¸é¤¨äº†ï¼Œå¸Œæœ›èƒ½å¹«åˆ°éœ€è¦çš„äººï½</p>
                        </div>
                         <!-- ç¯„ä¾‹è²¼æ–‡ 3 -->
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <img src="https://placehold.co/50x50/e0e7ff/4338ca?text=U" alt="Avatar" class="w-10 h-10 rounded-full">
                                <div>
                                    <p class="font-semibold text-gray-800">UrbanExplorer22</p>
                                    <p class="text-xs text-gray-500">1 å¤©å‰</p>
                                </div>
                            </div>
                            <p class="text-gray-700 mb-3">å‹Ÿé›†çš„å†¬è¡£é€é” NPO å›‰ï¼æ„Ÿè¬å¤§å®¶çš„æ„›å¿ƒ â¤ï¸</p>
                            <img src="https://placehold.co/400x250/e0e7ff/4338ca?text=Donation+Box" alt="è²¼æ–‡åœ–ç‰‡" class="w-full rounded-lg object-cover">
                        </div>
                    </div>

                    <!-- åˆ†é  2: æ’è¡Œæ¦œ (å¾èˆŠé é¢ç§»å…¥) -->
                    <div id="tab-panel-ranking" class="tab-panel p-4 space-y-4"> <!-- ã€ä¿®æ”¹ã€‘p-6 æ”¹ç‚º p-4 -->
                        <!-- æ’å 1 --><div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <span class="text-2xl font-bold text-gray-700">1</span>
                            <img src="https://placehold.co/50x50/e0e7ff/4338ca?text=U" alt="Avatar" class="w-12 h-12 rounded-full">
                            <div class="flex-grow">
                                <p class="font-bold text-gray-800">UrbanExplorer22</p>
                                <p class="text-sm text-gray-500">å·²å®Œæˆ 15 ä»¶ä»»å‹™</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-gray-800">510</p>
                                <p class="text-xs text-gray-500">ç©åˆ†</p>
                            </div>
                        </div>
                        
                        <!-- æ’å 2 --><div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <span class="text-2xl font-bold text-gray-700">2</span>
                            <img src="https://placehold.co/50x50/dbeafe/1e40af?text=G" alt="Avatar" class="w-12 h-12 rounded-full">
                            <div class="flex-grow">
                                <p class="font-bold text-gray-800">GreenGuardian8</p>
                                <p class="text-sm text-gray-500">å·²å®Œæˆ 13 ä»¶ä»»å‹™</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-gray-800">420</p>
                                <p class="text-xs text-gray-500">ç©åˆ†</p>
                            </div>
                        </div>

                        <!-- æ’å 3 --><div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <span class="text-2xl font-bold text-gray-700">3</span>
                            <img src="https://placehold.co/50x50/fef3c7/b45309?text=C" alt="Avatar" class="w-12 h-12 rounded-full">
                            <div class="flex-grow">
                                <p class="font-bold text-gray-800">ChanghuaHero99</p>
                                <p class="text-sm text-gray-500">å·²å®Œæˆ 12 ä»¶ä»»å‹™</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-gray-800">350</p>
                                <p class="text-xs text-gray-500">ç©åˆ†</p>
                            </div>
                        </div>

                        <!-- æ’å 4 --><div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <span class="text-2xl font-bold text-gray-700">4</span>
                            <img src="https://placehold.co/50x50/fecdd3/881337?text=C" alt="Avatar" class="w-12 h-12 rounded-full">
                            <div class="flex-grow">
                                <p class="font-bold text-gray-800">CivicLover123</p>
                                <p class="text-sm text-gray-500">å·²å®Œæˆ 8 ä»¶ä»»å‹™</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-gray-800">210</p>
                                <p class="text-xs text-gray-500">ç©åˆ†</p>
                            </div>
                        </div>

                        <!-- é€™æ˜¯æ‚¨ --><div class="bg-white border-2 border-green-500 rounded-lg shadow-lg p-4 flex items-center space-x-4">
                            <span class="text-2xl font-bold text-green-600">5</span>
                            <img src="https://placehold.co/50x50/c6f6d5/2f855a?text=You" alt="Your Avatar" class="w-12 h-12 rounded-full">
                            <div class="flex-grow">
                                <p class="font-bold text-gray-800">NCUEfreshman (æ‚¨)</p>
                                <p class="text-sm text-gray-500">å·²å®Œæˆ 1 ä»¶ä»»å‹™</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-green-600" id="ranking-your-points-clone">10</p> <!-- è¤‡è£½ ID -->
                                <p class="text-xs text-gray-500">ç©åˆ†</p>
                            </div>
                        </div>
                        
                        <!-- æ’å 6 --><div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <span class="text-2xl font-bold text-gray-700">6</span>
                            <img src="https://placehold.co/50x50/e5e7eb/4b5563?text=E" alt="Avatar" class="w-12 h-12 rounded-full">
                            <div class="flex-grow">
                                <p class="font-bold text-gray-800">EcoWalker77</p>
                                <p class="text-sm text-gray-500">å·²å®Œæˆ 1 ä»¶ä»»å‹™</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-gray-800">5</p>
                                <p class="text-xs text-gray-500">ç©åˆ†</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨å°èˆª (å…¨æ–° 5 é …ç›®çµæ§‹) --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top"> <!-- ç§»é™¤ fixed å’Œ style -->
                    <!-- 1. ä¸»é  -->
                    <button onclick="goToPage('page-home')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-house"></i>
                        <span class="text-xs mt-1">ä¸»é </span>
                    </button>
                    <!-- 2. ç¤¾ç¾¤ (ç•¶å‰é ) -->
                    <button onclick="goToPage('page-community-feed')" class="bottom-nav-item text-green-600">
                        <i class="fa-solid fa-users"></i>
                        <span class="text-xs font-semibold mt-1">ç¤¾ç¾¤</span>
                    </button>
                    <!-- 3. åœ°åœ– -->
                    <button onclick="goToPage('page-map')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-map-location-dot"></i>
                        <span class="text-xs mt-1">åœ°åœ–</span>
                    </button>
                    <!-- 4. çå‹µ -->
                    <button onclick="goToPage('page-rewards')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-gift"></i>
                        <span class="text-xs mt-1">çå‹µ</span>
                    </button>
                    <!-- 5. å€‹äºº -->
                    <button onclick="goToPage('page-garden')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-user"></i>
                        <span class="text-xs mt-1">å€‹äºº</span>
                    </button>
                </div>
            </div>
            
            <!-- 
                ============================================================
                ç•«é¢ 9: (éš±è—) ç¤¾å€ç™¼å¸ƒæˆåŠŸ
                ============================================================
            --><div id="modal-community-success" class="page" style="display: none; background-color: rgba(0,0,0,0.5);" onclick="closeModal('modal-community-success'); goToPage('page-map');">
                <div class="m-auto bg-white rounded-lg shadow-lg p-8 w-11/12 text-center" onclick="event.stopPropagation()">
                    <i class="fa-solid fa-circle-check fa-5x text-green-500 mx-auto"></i>
                    <h2 class="text-2xl font-bold text-gray-800 mt-4">ç™¼å¸ƒæˆåŠŸï¼</h2>
                    <p class="text-gray-600 mt-2">ã€Œé€±æœ«æ·¨ç˜æ´»å‹•ã€å·²ç™¼é€çµ¦é™„è¿‘çš„é„°é‡Œè‹±é›„ã€‚</p>
                    <button onclick="closeModal('modal-community-success'); goToPage('page-map');" class="mt-6 w-full bg-green-500 text-white font-semibold py-3 rounded-lg">
                        å¤ªå¥½äº†
                    </button>
                </div>
            </div>

            <!-- 
                ============================================================
                æ–°å¢ç•«é¢ (Home): ä¸»é 
                ============================================================
            --><div id="page-home" class="page bg-gray-50">
                <!-- é ‚éƒ¨å°èˆª --><div class="mini-app-header w-full p-4 flex items-center justify-between shadow-sm">
                    <h1 class="text-xl font-bold text-gray-800">ä¸»é </h1>
                    <button class="w-10 h-10 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center">
                        <i class="fa-solid fa-bell"></i>
                    </button>
                </div>

                <!-- å¯æ²å‹•å…§å®¹å€ -->
                <div class="flex-grow overflow-y-auto p-6 space-y-6"> <!-- ç§»é™¤ pb-16 -->
                    
                    <!-- ç¸½å®Œæˆä»»å‹™å¡ -->
                    <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                        <p class="text-sm text-gray-500">æ‚¨ç¸½å…±å®Œæˆäº†</p>
                        <p class="text-4xl font-bold text-green-600 my-2"><span id="home-tasks-completed">0</span> é …ä»»å‹™</p>
                        <p class="text-sm text-gray-600">æ„Ÿè¬æ‚¨ç‚ºç¤¾å€çš„è²¢ç»ï¼</p>
                    </div>

                    <!-- æ´»å‹•å…¬å‘Š -->
                    <div>
                        <h2 class="text-lg font-semibold text-gray-800 mb-3">æ´»å‹•å…¬å‘Š</h2>
                        <div class="bg-white rounded-lg shadow p-4">
                            <img src="https://placehold.co/400x150/d1fae5/065f46?text=Weekend+Cleanup" alt="æ´»å‹•åœ–ç‰‡" class="w-full rounded-lg object-cover mb-3">
                            <h3 class="font-bold text-gray-800">é€±æœ«æ·¨ç˜è‹±é›„å¬é›†ä»¤ï¼</h3>
                            <p class="text-sm text-gray-600 mt-1">æœ¬é€±æœ«åœ¨å½°åŒ–æµ·æ¿±ï¼Œæˆ‘å€‘éœ€è¦æ‚¨çš„åŠ›é‡ï¼Œä¸€èµ·è®“æµ·å²¸ç·šæ›´ç¾éº—ã€‚</p>
                        </div>
                    </div>

                    <!-- æ°¸ä¹…ä»»å‹™ -->
                    <div>
                        <h2 class="text-lg font-semibold text-gray-800 mb-3">æ°¸ä¹…ä»»å‹™</h2>
                        <div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-user-group fa-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">é‚€è«‹å¤¥ä¼´</h3>
                                <p class="text-sm text-gray-600">é‚€è«‹ä¸€ä½å¥½å‹åŠ å…¥ CivicGoï¼Œå³å¯ç²å¾— 20 ç©åˆ†ï¼</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é€šçŸ¥ -->
                    <div>
                        <h2 class="text-lg font-semibold text-gray-800 mb-3">æœ€æ–°é€šçŸ¥</h2>
                        <div class="bg-white rounded-lg shadow divide-y divide-gray-100">
                            <div class_id="notification-1" class="p-4 flex items-center space-x-3">
                                <i class="fa-solid fa-circle-check text-green-500 fa-lg"></i>
                                <p class="text-sm text-gray-700">æ‚¨çš„ä»»å‹™ã€Œéš¨æ‰‹æ’¿åƒåœ¾ã€å·²é€šéé©—è­‰ï¼ç²å¾— 10 é»ç©åˆ†ã€‚</p>
                            </div>
                            <div class="p-4 flex items-center space-x-3">
                                <i class="fa-solid fa-bullhorn text-blue-500 fa-lg"></i>
                                <p class="text-sm text-gray-700">ã€Œå‹Ÿé›†äºŒæ‰‹å†¬è¡£ã€ä»»å‹™å·²æ›´æ–°åœ°é»ï¼Œè«‹æŸ¥çœ‹è©³æƒ…ã€‚</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- åº•éƒ¨å°èˆª (å…¨æ–° 5 é …ç›®çµæ§‹) --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top"> <!-- ç§»é™¤ fixed å’Œ style -->
                    <!-- 1. ä¸»é  (ç•¶å‰é ) -->
                    <button onclick="goToPage('page-home')" class="bottom-nav-item text-green-600">
                        <i class="fa-solid fa-house"></i>
                        <span class="text-xs font-semibold mt-1">ä¸»é </span>
                    </button>
                    <!-- 2. ç¤¾ç¾¤ -->
                    <button onclick="goToPage('page-community-feed')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-users"></i>
                        <span class="text-xs mt-1">ç¤¾ç¾¤</span>
                    </button>
                    <!-- 3. åœ°åœ– -->
                    <button onclick="goToPage('page-map')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-map-location-dot"></i>
                        <span class="text-xs mt-1">åœ°åœ–</span>
                    </button>
                    <!-- 4. çå‹µ -->
                    <button onclick="goToPage('page-rewards')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-gift"></i>
                        <span class="text-xs mt-1">çå‹µ</span>
                    </button>
                    <!-- 5. å€‹äºº -->
                    <button onclick="goToPage('page-garden')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-user"></i>
                        <span class="text-xs mt-1">å€‹äºº</span>
                    </button>
                </div>
            </div>

            <!-- 
                ============================================================
                æ–°å¢ç•«é¢ (Rewards): çå‹µ
                ============================================================
            --><div id="page-rewards" class="page bg-gray-50">
                <!-- é ‚éƒ¨å°èˆª --><div class="mini-app-header w-full p-4 flex items-center justify-between shadow-sm">
                    <h1 class="text-xl font-bold text-gray-800">çå‹µ</h1>
                    <span class="w-10 h-10"></span> <!-- ä½”ä½ç¬¦ -->
                </div>

                <!-- å¯æ²å‹•å…§å®¹å€ -->
                <div class="flex-grow overflow-y-auto p-6 space-y-6"> <!-- ç§»é™¤ pb-16 -->
                    
                    <!-- é¡¯ç¤ºç›®å‰ç©åˆ† -->
                    <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                        <p class="text-sm text-gray-500">æˆ‘ç›®å‰çš„ç©åˆ†</p>
                        <p class="text-4xl font-bold text-green-600 my-2" id="rewards-current-points">0</p>
                    </div>

                    <!-- çå‹µå…Œæ› (å¾ page-garden ç§»å…¥) -->
                    <div class="bg-white p-6 shadow-inner-top rounded-lg"> 
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ç©åˆ†å…Œæ›</h3>
                        <div class="space-y-4">
                            <button id="redeem-line-btn-clone" onclick="redeemLinePoints(500)" class="w-full bg-[#06C755] text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-between shadow transition-opacity duration-200 enabled:hover:opacity-80">
                                <span><i class="fa-brands fa-line fa-lg mr-2"></i>å…Œæ› 50 é» LINE POINTS</span>
                                <span class="bg-white text-green-600 text-sm font-bold px-2 py-1 rounded">500 ç©åˆ†</span>
                            </button>
                            <button id="redeem-coffee-btn-clone" onclick="redeemCoffeeVoucher(300)" class="w-full bg-yellow-500 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-between shadow transition-opacity duration-200 enabled:hover:opacity-80">
                                <span><i class="fa-solid fa-store mr-2"></i>å…Œæ› åœ¨åœ°å•†å®¶å’–å•¡åˆ¸</span>
                                <span class="bg-white text-yellow-800 text-sm font-bold px-2 py-1 rounded">300 ç©åˆ†</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨å°èˆª (å…¨æ–° 5 é …ç›®çµæ§‹) --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top"> <!-- ç§»é™¤ fixed å’Œ style -->
                    <!-- 1. ä¸»é  -->
                    <button onclick="goToPage('page-home')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-house"></i>
                        <span class="text-xs mt-1">ä¸»é </span>
                    </button>
                    <!-- 2. ç¤¾ç¾¤ -->
                    <button onclick="goToPage('page-community-feed')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-users"></i>
                        <span class="text-xs mt-1">ç¤¾ç¾¤</span>
                    </button>
                    <!-- 3. åœ°åœ– -->
                    <button onclick="goToPage('page-map')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-map-location-dot"></i>
                        <span class="text-xs mt-1">åœ°åœ–</span>
                    </button>
                    <!-- 4. çå‹µ (ç•¶å‰é ) -->
                    <button onclick="goToPage('page-rewards')" class="bottom-nav-item text-green-600">
                        <i class="fa-solid fa-gift"></i>
                        <span class="text-xs font-semibold mt-1">çå‹µ</span>
                    </button>
                    <!-- 5. å€‹äºº -->
                    <button onclick="goToPage('page-garden')" class="bottom-nav-item text-gray-500">
                        <i class="fa-solid fa-user"></i>
                        <span class="text-xs mt-1">å€‹äºº</span>
                    </button>
                </div>
            </div>

            <!-- è‡ªå®šç¾©æç¤ºæ¡† --><div id="custom-alert" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-xl p-8 w-11/12 text-center" style="display: none; z-index: 999;">
                <p id="custom-alert-message" class="text-gray-700 text-lg">è¨Šæ¯</p>
                <button onclick="closeSimpleAlert()" class="mt-6 w-full bg-green-500 text-white font-semibold py-2 rounded-lg">
                    ç¢ºèª
                </button>
            </div>
            <div id="alert-overlay" class="absolute inset-0 bg-black/40" style="display: none; z-index: 998;" onclick="closeSimpleAlert()"></div>

        </div> <!-- çµæŸ .mobile-content --></div> <!-- çµæŸ .mobile-shell --><script>
        // --- å…¨åŸŸç‹€æ…‹ç®¡ç† (æ¨¡æ“¬) ---
        let currentPoints = 0;
        let tasksCompleted = 0;
        let flowersInGarden = [];
        let trustScore = 100; 
        let acceptedTasks = []; // æ–°å¢ï¼šå„²å­˜å·²æ¥å—çš„ä»»å‹™
        let currentTaskToValidate = null; // å„²å­˜ç•¶å‰è¦é©—è­‰çš„ä»»å‹™ ID

        // --- ä»»å‹™è³‡æ–™åº« (æ¨¡æ“¬) ---
        const taskDatabase = {
            'task1': {
                id: 'task1',
                title: 'éš¨æ‰‹æ’¿åƒåœ¾',
                type: 'ä»»å‹™å°å‘',
                location: 'é€²å¾·è·¯å®‰å…¨å³¶ (è·é›¢ 50m)',
                description: 'å”åŠ©æ¸…ç†è©²å€åŸŸçš„å¡‘è† ç“¶èˆ‡ç´™å±‘ã€‚ç’°å¢ƒéœ€è¦ä½ æˆ‘å…±åŒå®ˆè­·ï¼',
                validation: 'AI åœ–åƒè¾¨è­˜',
                reward: 10,
                completed: false
            },
            'task2': {
                id: 'task2',
                title: 'æè´ˆäºŒæ‰‹æ›¸ (7æˆæ–°)',
                type: 'è³‡æºå°å‘',
                location: 'å½°åŒ–å¸«å¤§åœ–æ›¸é¤¨ (è·é›¢ 200m)',
                description: 'è®“çŸ¥è­˜æµå‹•ï¼åœ–æ›¸é¤¨æ­£ç‚ºåé„‰å‹Ÿé›†å…’ç«¥è®€ç‰©ã€‚',
                validation: 'æ«ƒå°äººå“¡æƒç¢¼',
                reward: 20,
                completed: false
            },
            'task3': {
                id: 'task3',
                title: 'å‹Ÿé›†äºŒæ‰‹å†¬è¡£ (NPO)',
                type: 'ç¤¾å€éœ€æ±‚',
                location: 'å½°å¸«å¤§ç‰¹æ•™ç³»è¾¦ (è·é›¢ 150m)',
                description: 'ç‚ºç¨å±…é•·è€…å‹Ÿé›†äºŒæ‰‹ä¿æš–å†¬è¡£ï¼Œæ‚¨çš„æ„›å¿ƒæ˜¯å†¬æ—¥è£¡æœ€æš–çš„é™½å…‰ã€‚',
                validation: 'å¿—å·¥ç¢ºèª',
                reward: 30,
                completed: false
            }
        };

        // --- é é¢å°èˆª ---
        let currentPage = 'page-splash';

        function goToPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.add('active');
                    if (pageId === 'page-home') {
                        updateHomeStats();
                    }
                    if (pageId === 'page-garden') {
                        updateGardenStats();
                    }
                    if (pageId === 'page-rewards') {
                        updateRewardsStats();
                    }
                    if (pageId === 'page-community-feed') { // æ›´æ–°ï¼šæŒ‡å‘æ–°é é¢
                        // æ›´æ–°æ’è¡Œæ¦œåˆ†é ä¸­çš„ç©åˆ†
                        document.getElementById('ranking-your-points-clone').innerText = currentPoints;
                    }
                    if (pageId === 'page-map') {
                        updateTaskPinsStatus(); // æ¯æ¬¡åˆ°åœ°åœ–é éƒ½æ›´æ–°åœ–é‡˜
                    }
                } else {
                    page.classList.remove('active');
                }
            });
            currentPage = pageId;
        }

        // --- å½ˆçª— (Modal) æ§åˆ¶ ---
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- è‡ªå®šç¾©æç¤ºæ¡† (å–ä»£ alert) ---
        function showSimpleAlert(message) {
            document.getElementById('custom-alert-message').innerText = message;
            document.getElementById('custom-alert').style.display = 'block';
            document.getElementById('alert-overlay').style.display = 'block';
        }
        function closeSimpleAlert() {
            document.getElementById('custom-alert').style.display = 'none';
            document.getElementById('alert-overlay').style.display = 'none';
        }
        window.alert = showSimpleAlert;


        // --- ã€ä¿®æ”¹ã€‘ç¤¾ç¾¤åˆ†é åˆ‡æ› (è† å›Šæ¨£å¼) ---
        function showTab(tabName) {
            const feedBtn = document.getElementById('tab-btn-feed');
            const rankingBtn = document.getElementById('tab-btn-ranking');
            
            if (tabName === 'feed') {
                // å•Ÿç”¨å‹•æ…‹æŒ‰éˆ•
                feedBtn.classList.add('bg-white', 'text-green-600', 'shadow-md');
                feedBtn.classList.remove('text-gray-600');
                // ç¦ç”¨æ’è¡Œæ¦œæŒ‰éˆ•
                rankingBtn.classList.remove('bg-white', 'text-green-600', 'shadow-md');
                rankingBtn.classList.add('text-gray-600');
            } else {
                // ç¦ç”¨å‹•æ…‹æŒ‰éˆ•
                feedBtn.classList.remove('bg-white', 'text-green-600', 'shadow-md');
                feedBtn.classList.add('text-gray-600');
                // å•Ÿç”¨æ’è¡Œæ¦œæŒ‰éˆ•
                rankingBtn.classList.add('bg-white', 'text-green-600', 'shadow-md');
                rankingBtn.classList.remove('text-gray-600');
            }
            
            // åˆ‡æ›é¢æ¿å…§å®¹
            document.getElementById('tab-panel-feed').classList.toggle('active', tabName === 'feed');
            document.getElementById('tab-panel-ranking').classList.toggle('active', tabName === 'ranking');

            // å¦‚æœåˆ‡æ›åˆ°æ’è¡Œæ¦œï¼Œåˆ·æ–°ä¸€ä¸‹ç©åˆ†
            if (tabName === 'ranking') {
                document.getElementById('ranking-your-points-clone').innerText = currentPoints;
            }
        }

        // --- æ ¸å¿ƒæµç¨‹ ---
        
        // --- æ–°å¢ï¼šæ›´æ–°ä¸»é ç‹€æ…‹ ---
        function updateHomeStats() {
            document.getElementById('home-tasks-completed').innerText = tasksCompleted;
        }

        // --- æ–°å¢ï¼šæ›´æ–°çå‹µé ç‹€æ…‹ ---
        function updateRewardsStats() {
            document.getElementById('rewards-current-points').innerText = currentPoints;
        }

        // æ–°å¢ï¼šæ›´æ–°åœ°åœ–ä¸Šæ‰€æœ‰åœ–é‡˜çš„ç‹€æ…‹
        function updateTaskPinsStatus() {
            Object.values(taskDatabase).forEach(task => {
                const pin = document.getElementById(`pin-${task.id}`);
                if (!pin) return;

                if (task.completed) {
                    pin.style.display = 'none'; // éš±è—å·²å®Œæˆçš„
                } else if (acceptedTasks.includes(task.id)) {
                    pin.classList.add('active'); // æ¨™è¨˜é€²è¡Œä¸­ (é–ƒçˆ)
                } else {
                    pin.classList.remove('active'); // ç§»é™¤é–ƒçˆ
                }
            });
        }

        // 1. é¡¯ç¤ºä»»å‹™è©³æƒ…
        function showTaskDetail(taskId) {
            const task = taskDatabase[taskId];
            if (!task || task.completed) return; // å¦‚æœä»»å‹™ä¸å­˜åœ¨æˆ–å·²å®Œæˆï¼Œä¸é¡¯ç¤º

            const contentEl = document.getElementById('task-detail-content');
            contentEl.innerHTML = `
                <span class="inline-block bg-green-100 text-green-700 text-xs font-semibold px-2 py-1 rounded-full mb-2">${task.type}</span>
                <h2 class="text-2xl font-bold text-gray-800">${task.title}</h2>
                <p class="text-gray-600 mt-2">${task.location}</p>
                <p class="text-gray-700 mt-4">${task.description}</p>
                <div class="mt-4 bg-gray-50 p-3 rounded-lg">
                    <p class="text-sm font-medium text-gray-700">é©—è­‰æ–¹å¼ï¼š<span class="font-normal text-gray-600">${task.validation}</span></p>
                    <p class="text-sm font-medium text-gray-700 mt-1">é è¨ˆçå‹µï¼š<span class="font-bold text-green-600">${task.reward} ç©åˆ†</span></p>
                </div>
            `;
            
            const acceptBtn = document.getElementById('accept-task-btn');

            if (acceptedTasks.includes(taskId)) {
                // æƒ…æ³ 2: å·²æ¥å—ï¼Œé¡¯ç¤ºã€Œé»æ“Šé©—è­‰ã€
                acceptBtn.innerText = 'é»æ“Šé©—è­‰'; 
                acceptBtn.onclick = () => goToValidationPage(taskId);
            } else {
                // æƒ…æ³ 1: æœªæ¥å—ï¼Œé¡¯ç¤ºã€Œæ¥å—ä»»å‹™ã€
                acceptBtn.innerText = 'æ¥å—ä»»å‹™'; 
                acceptBtn.onclick = () => acceptTask(taskId);
            }

            showModal('modal-task-detail');
        }

        // æ­¥é©Ÿ 1.5: ä½¿ç”¨è€…æŒ‰ä¸‹ã€Œæ¥å—ä»»å‹™ã€
        function acceptTask(taskId) {
            if (!acceptedTasks.includes(taskId)) {
                acceptedTasks.push(taskId); // åŠ å…¥å·²æ¥å—åˆ—è¡¨
            }
            
            const pin = document.getElementById(`pin-${taskId}`);
            if (pin) {
                pin.classList.add('active'); // å¢åŠ é–ƒçˆæ•ˆæœ
            }

            closeModal('modal-task-detail'); // é—œé–‰å½ˆçª—ï¼Œå›åˆ°åœ°åœ–
        }

        // æ­¥é©Ÿ 1.6: ä½¿ç”¨è€…æŒ‰ä¸‹ã€Œé»æ“Šé©—è­‰ã€ï¼Œæº–å‚™è·³è½‰åˆ°é©—è­‰é é¢
        function goToValidationPage(taskId) {
            currentTaskToValidate = taskId; // å„²å­˜ç•¶å‰ä»»å‹™ID
            const task = taskDatabase[taskId];

            // æ›´æ–°é©—è­‰é é¢çš„æç¤ºæ–‡å­—
            const validationText = document.getElementById('validation-instruction');
            if (validationText) {
                if (taskId === 'task1') {
                    validationText.innerText = 'è«‹æ‹æ”æ‚¨æ”¶é›†çš„åƒåœ¾è¢‹';
                } else if (taskId === 'task2') {
                    validationText.innerText = 'è«‹æ‹æ”æ‚¨è¦æè´ˆçš„æ›¸ç±';
                } else if (taskId === 'task3') {
                    validationText.innerText = 'è«‹æ‹æ”æ‚¨è¦æè´ˆçš„å†¬è¡£';
                } else {
                    validationText.innerText = 'è«‹æ‹æ”ä»»å‹™å®Œæˆè­‰æ˜';
                }
            }
            
            closeModal('modal-task-detail');
            goToPage('page-validation');
        }

        // é¡¯ç¤º AI é©—è­‰è®€å– (å¾é©—è­‰é é¢è§¸ç™¼)
        function startAIVerification() {
            if (!currentTaskToValidate) return; // å®‰å…¨æª¢æŸ¥

            const verifyingEl = document.getElementById('ai-verifying');
            verifyingEl.style.display = 'flex'; // é¡¯ç¤ºè®€å–å‹•ç•«

            // æ¨¡æ“¬ AI é©—è­‰ 2 ç§’
            setTimeout(() => {
                verifyingEl.style.display = 'none'; // éš±è—è®€å–å‹•ç•«
                showValidationResult(currentTaskToValidate); // é¡¯ç¤ºæˆåŠŸé é¢
                currentTaskToValidate = null; // æ¸…é™¤
            }, 2000);
        }


        // 2. é¡¯ç¤ºé©—è­‰çµæœ (ä»»å‹™æˆåŠŸ)
        function showValidationResult(taskId) {
            const task = taskDatabase[taskId];
            if (!task) return;

            // æ›´æ–°å…¨åŸŸç‹€æ…‹
            currentPoints += task.reward;
            tasksCompleted += 1;
            trustScore += 5; 
            flowersInGarden.push(getRandomFlower()); 
            task.completed = true; // æ¨™è¨˜ä»»å‹™ç‚ºå·²å®Œæˆ

            // å¾ acceptedTasks é™£åˆ—ä¸­ç§»é™¤
            acceptedTasks = acceptedTasks.filter(id => id !== taskId);

            // ç§»é™¤åœ–é‡˜çš„é–ƒçˆæ•ˆæœä¸¦éš±è—
            const pin = document.getElementById(`pin-${taskId}`);
            if (pin) {
                pin.classList.remove('active');
                pin.style.display = 'none'; // ç«‹å³éš±è—
            }

            document.getElementById('reward-points').innerText = task.reward;
            
            closeModal('modal-task-detail'); 
            goToPage('page-success'); 
        } 

        // 3. æ›´æ–°èŠ±åœ’é é¢ (å€‹äººä¸­å¿ƒ)
        function updateGardenStats() {
            // æ›´æ–°æ–°çš„å››æ ¼çµ±è¨ˆç‰ˆ
            document.getElementById('garden-total-points').innerText = currentPoints;
            document.getElementById('garden-tasks-completed').innerText = tasksCompleted;
            document.getElementById('garden-trust-score').innerText = trustScore; 
            
            // æ›´æ–°æ–°ç‰ˆæ’è¡Œæ¦œä¸Šçš„ç©åˆ†
            document.getElementById('ranking-your-points-clone').innerText = currentPoints;
            
            // æ›´æ–°æˆ°ç¸¾
            // é€™è£¡åªæ˜¯æ¨¡æ“¬ï¼Œæ‰€ä»¥æˆ‘å€‘åªæ›´æ–°ã€Œæœ¬å¹´ã€
            const annualTasksEl = document.querySelector('#page-garden span.font-bold.text-lg.text-gray-900');
            if(annualTasksEl) {
                // ç°¡æ˜“æ›´æ–°ï¼Œå‡è¨­æ‰€æœ‰ä»»å‹™éƒ½æ˜¯ä»Šå¹´çš„
                document.querySelectorAll('#page-garden span.font-bold.text-lg.text-gray-900')[0].innerText = tasksCompleted;
                document.querySelectorAll('#page-garden span.font-bold.text-lg.text-gray-900')[1].innerText = tasksCompleted;
            }


            const container = document.getElementById('flower-container');
            container.innerHTML = ''; // æ¸…ç©ºï¼Œé‡æ–°ç¹ªè£½

            // èª¿æ•´èŠ±æœµä½ç½®ï¼Œè®“å®ƒå€‘åœ¨åŸå¸‚å¤©éš›ç·šä¹‹ä¸Š
            flowersInGarden.forEach((flowerSVG, index) => {
                const flowerEl = document.createElement('div');
                flowerEl.className = 'flower absolute'; // ä½¿ç”¨ absolute å®šä½
                const leftPosition = 15 + (index % 6) * 14; // éš¨æ©Ÿåˆ†æ•£åœ¨å¯¬åº¦å…§
                const bottomPosition = 20 + (index % 3) * 15; // é«˜åº¦ä¹Ÿéš¨æ©Ÿèª¿æ•´ (å¾ 20px ~ 50px)
                flowerEl.style.cssText = `
                    left: ${leftPosition}%; 
                    bottom: ${bottomPosition}px; 
                    transform: translateX(-50%) scale(0.5);
                `;
                flowerEl.innerHTML = flowerSVG;
                container.appendChild(flowerEl);

                setTimeout(() => {
                    flowerEl.classList.add('visible');
                    flowerEl.style.transform = `translateX(-50%) scale(1)`; // è®“èŠ±æœµé•·å¤§
                }, 100 * index);
            });
        }
        
        // --- çå‹µå…Œæ›äº’å‹•åŠŸèƒ½ ---

        function redeemLinePoints(cost) {
            if (currentPoints >= cost) {
                // æ‰£é™¤é»æ•¸
                currentPoints -= cost;
                // æ›´æ–°é¡¯ç¤º
                updateGardenStats(); // é€™æœƒåˆ·æ–°èŠ±åœ’é é¢ä¸Šçš„æ‰€æœ‰æ•¸æ“š
                updateRewardsStats(); // åŒæ™‚æ›´æ–°çå‹µé é¢
                // é¡¯ç¤ºæˆåŠŸæç¤º
                showSimpleAlert(`å…Œæ›æˆåŠŸï¼å·²èŠ±è²» ${cost} ç©åˆ†å…Œæ› 50 é» LINE POINTSã€‚`);
            } else {
                // é¡¯ç¤ºå¤±æ•—æç¤º
                showSimpleAlert(`ç©åˆ†ä¸è¶³ï¼æ‚¨é‚„éœ€è¦ ${cost - currentPoints} ç©åˆ†æ‰èƒ½å…Œæ›ã€‚`);
            }
        }

        function redeemCoffeeVoucher(cost) {
            if (currentPoints >= cost) {
                // æ‰£é™¤é»æ•¸
                currentPoints -= cost;
                // æ›´æ–°é¡¯ç¤º
                updateGardenStats(); // é€™æœƒåˆ·æ–°èŠ±åœ’é é¢ä¸Šçš„æ‰€æœ‰æ•¸æ“š
                updateRewardsStats(); // åŒæ™‚æ›´æ–°çå‹µé é¢
                // é¡¯ç¤ºæˆåŠŸæç¤º
                showSimpleAlert(`å…Œæ›æˆåŠŸï¼å·²èŠ±è²» ${cost} ç©åˆ†å…Œæ›åœ¨åœ°å•†å®¶å’–å•¡åˆ¸ã€‚`);
            } else {
                // é¡¯ç¤ºå¤±æ•—æç¤º
                showSimpleAlert(`ç©åˆ†ä¸è¶³ï¼æ‚¨é‚„éœ€è¦ ${cost - currentPoints} ç©åˆ†æ‰èƒ½å…Œæ›ã€‚`);
            }
        }

        // é‡è¨­æ‰‹å‹•è¡¨å–®
        function resetManualForm() {
            const fields = ['task-title', 'task-description', 'task-location', 'task-time', 'task-people', 'task-reward'];
            fields.forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function showCommunitySuccess() {
            // closeModal('modal-community-post'); // é€™é é¢å·²é modal
            goToPage('page-map'); // è¿”å›åœ°åœ–
            showModal('modal-community-success'); // é¡¯ç¤ºæˆåŠŸå½ˆçª—
            setTimeout(resetManualForm, 500); // é—œé–‰æ™‚é‡è¨­è¡¨å–®
        }

        function getRandomFlower() {
            const colors = ['#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6']; 
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            return `
                <svg class="w-12 h-12" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- Stem --><path d="M 50 100 V 60" stroke="#10B981" stroke-width="4" />
                    <!-- Petals --><circle cx="50" cy="40" r="15" fill="${color}" opacity="0.7"/>
                    <circle cx="35" cy="50" r="15" fill="${color}" opacity="0.7"/>
                    <circle cx="65" cy="50" r="15" fill="${color}" opacity="0.7"/>
                    <circle cx="50" cy="60" r="15" fill="${color}" opacity="0.7"/>
                    <!-- Center --><circle cx="50" cy="50" r="12" fill="#FDE047"/>
                </svg>
            `;
        }

    </script>
</body>
</html>